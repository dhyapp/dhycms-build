import{_ as O}from"./cloud-poster-upload-BX1FWnPW.js";import{_ as J}from"./admin-form-action-bar-CaxKRg0f.js";import{u as Q}from"./index-EJK1-8dv.js";import{a as W,b as X}from"./index-LDJIlj3e.js";import{a4 as Z,ae as j,c as R,f as v,r as H,o as K,a6 as S,W as T,k as e,$ as t,u as a,X as c,F as $,J as C,V as b,G as n,a1 as M,Z as V,a2 as B,a7 as h}from"./vue-DoSrNxHp.js";import{u as ee,p as F,l as ae}from"./coms-BGBaUFfq.js";import{bP as g,bQ as le,aA as N,bN as E,bO as te,bT as se,ae as oe,bD as ue,bG as P}from"./ant1-FgANxHEo.js";import{e as ne,F as u,d as re,I as m,s as z,t as p,f as de}from"./ant2-F-VMf9eP.js";import"./modal-DZ8O4vOv.js";import"./main-CiTClfZk.js";import"./index-DoS9QrfY.js";const ie={class:"f ac"},me={class:"pannel user-edit-page"},pe=c("div",{class:"phead"},"用户编辑",-1),fe={class:"form-max pt20 pr20 pb30 pl30"},Re={__name:"edit",setup(ve){const r=Z(),k=j(),x=ee(),I=R(()=>x.preadmin),G=R(()=>x.user),U={label:4,wrapper:18},D=v(null),l=H({id:r.params.id||F(8,!0),pid:[],username:"",nickname:"",realname:"",sex:2,email:"",phone:"",password:"",wx:"",alipay:"",IPs:[],role:"normal",status:"normal",avatar:"",frozen:!1,security:0,coin:0,commission:0,commissionFrozen:0,vipEndTime:0,freeDownloadCount:1,maxDownloadCount:1}),_=v(""),q={normal:{name:"普通用户",color:"info"},admin:{name:"管理员",color:"admin"},super:{name:"超级管理员",color:"super"}},w=v(!1),y=v(!1),A=async d=>{try{w.value=!0,await Q.get({id:d}).then(s=>{const f=C(l);for(const i in f)l[i]=s[i]||l[i];l.vipEndTime&&(_.value=ae(+`${l.vipEndTime}000`,"YYYY-MM-DD")),["admin","super"].includes(l.role)&&(l.roleDisabledEdit=!0)})}finally{w.value=!1}},L=async()=>{try{y.value=!0,await D.value.validate();const d=C(l);_.value&&(d.vipEndTime=Math.round(new Date(_.value).getTime()/1e3)),!r.params.id?await W(d).then(()=>{P.success("添加成功"),k.back()}):await X(r.params.id,d).then(()=>{P.success("保存成功"),k.back()})}finally{y.value=!1}};return K(()=>{r.params.id&&A(r.params.id)}),(d,s)=>{const f=S("MIcon"),i=S("RouterLink");return b(),T($,null,[e(a(le),null,{default:t(()=>[e(a(g),null,{default:t(()=>[e(i,{to:`/${I.value}`},{default:t(()=>[e(f,{name:"dashboard",class:"mr6"}),n("控制台")]),_:1},8,["to"])]),_:1}),e(a(g),null,{default:t(()=>[e(i,{to:`/${I.value}/users`},{default:t(()=>[n("用户管理")]),_:1},8,["to"])]),_:1}),e(a(g),null,{default:t(()=>[n("编辑")]),_:1})]),_:1}),e(J,{class:"mt14"},{default:t(()=>[c("div",ie,[e(a(N),{type:"primary",loading:y.value,onClick:s[0]||(s[0]=o=>L())},{default:t(()=>[n(M(a(r).params.id?"提交":"添加"),1)]),_:1},8,["loading"])])]),_:1}),c("div",me,[pe,c("div",fe,[e(a(ue),{spinning:w.value},{default:t(()=>[e(a(ne),{ref_key:"formRef",ref:D,model:l,labelAlign:"left","label-col":{span:U.label},"wrapper-col":{span:U.wrapper}},{default:t(()=>[e(a(u),{label:"头像"},{default:t(()=>[e(O,{text:"上传头像",modelValue:l.avatar,"onUpdate:modelValue":s[1]||(s[1]=o=>l.avatar=o)},null,8,["modelValue"])]),_:1}),a(r).params.id!=1e4?(b(),V(a(u),{key:0,label:"ID",name:"id",rules:[{required:!0,message:"ID不能为空"}]},{default:t(()=>[e(a(re),{compact:""},{default:t(()=>[e(a(m),{value:l.id,"onUpdate:value":s[2]||(s[2]=o=>l.id=o),style:{width:"calc(100% - 88px)"}},null,8,["value"]),e(a(N),{style:{width:"88px"},onClick:s[3]||(s[3]=o=>l.id=a(F)(8,!0))},{default:t(()=>[n("重新生成")]),_:1})]),_:1})]),_:1})):B("",!0),e(a(u),{label:"用户名",name:"username",rules:[{required:!0,message:"用户名不能为空"}]},{default:t(()=>[e(a(m),{value:l.username,"onUpdate:value":s[4]||(s[4]=o=>l.username=o)},null,8,["value"])]),_:1}),e(a(u),{label:"密码",name:"password",rules:[{required:!0,message:"密码不能为空"}]},{default:t(()=>[e(a(m),{value:l.password,"onUpdate:value":s[5]||(s[5]=o=>l.password=o),type:"password"},null,8,["value"])]),_:1}),e(a(u),{label:"邮箱",name:"email",rules:[{required:!0,message:"邮箱不能为空"}]},{default:t(()=>[e(a(m),{value:l.email,"onUpdate:value":s[6]||(s[6]=o=>l.email=o)},null,8,["value"])]),_:1}),e(a(u),{label:"手机号",name:"phone"},{default:t(()=>[e(a(m),{value:l.phone,"onUpdate:value":s[7]||(s[7]=o=>l.phone=o)},null,8,["value"])]),_:1}),e(a(u),{label:"昵称",name:"nickname"},{default:t(()=>[e(a(m),{value:l.nickname,"onUpdate:value":s[8]||(s[8]=o=>l.nickname=o)},null,8,["value"])]),_:1}),e(a(u),{label:"性别",name:"sex"},{default:t(()=>[e(a(z),{value:l.sex,"onUpdate:value":s[9]||(s[9]=o=>l.sex=o)},{default:t(()=>[e(a(p),{value:0},{default:t(()=>[n("女")]),_:1}),e(a(p),{value:1},{default:t(()=>[n("男")]),_:1}),e(a(p),{value:2},{default:t(()=>[n("保密")]),_:1})]),_:1},8,["value"])]),_:1}),a(r).params.id?(b(),V(a(u),{key:1,label:"IP",name:"IPs"},{default:t(()=>[e(a(E),{mode:"tags",value:l.IPs,"onUpdate:value":s[10]||(s[10]=o=>l.IPs=o)},null,8,["value"])]),_:1})):B("",!0),e(a(u),{label:"角色/会员",name:"role"},{default:t(()=>[e(a(E),{value:l.role,"onUpdate:value":s[11]||(s[11]=o=>l.role=o),placeholder:"请选择角色/会员",disabled:l.id==G.value.id},{default:t(()=>[(b(),T($,null,h(q,(o,Y)=>e(a(te),{value:Y},{default:t(()=>[n(M(o.name),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","disabled"])]),_:1}),e(a(u),{label:"是否冻结",name:"frozen"},{default:t(()=>[e(a(z),{value:l.frozen,"onUpdate:value":s[12]||(s[12]=o=>l.frozen=o)},{default:t(()=>[e(a(p),{value:!1},{default:t(()=>[n("否")]),_:1}),e(a(p),{value:!0},{default:t(()=>[n("是")]),_:1})]),_:1},8,["value"])]),_:1}),e(a(u),{label:"账户安全等级",name:"security"},{default:t(()=>[e(a(se),null,{default:t(()=>[e(a(de),{value:l.security,"onUpdate:value":s[13]||(s[13]=o=>l.security=o),min:0},null,8,["value"]),e(a(oe),{title:"数值越高，表示账户风险越高"},{default:t(()=>[e(f,{name:"info",class:"fs16"})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-col","wrapper-col"])]),_:1},8,["spinning"])])])],64)}}};export{Re as default};
