import{u as F,d as K}from"./coms-BGBaUFfq.js";import{c as b,ae as A,f as B,w as U,o as W,a6 as L,V as r,W as u,k as a,$ as n,u as t,G as m,X as $,Z as _,F as k,a7 as H}from"./vue-DoSrNxHp.js";import{_ as Q}from"./card-sfuo-F3J.js";import{i as X,b as Z}from"./dhy-gnABKZL-.js";import{bP as g,bQ as j,bU as C,bW as q,bV as z,bA as M,bD as J,bG as d}from"./ant1-FgANxHEo.js";import"./ant2-F-VMf9eP.js";const O={class:"pannel mt14 template-page"},Y={class:"pb20 pl20 pr20 pt20"},ee={key:0,class:"f fw list"},ce={__name:"index",setup(te){const G=F(),c=K(),y=b(()=>G.preadmin),w=A(),h=B("templates"),P=B(!1),v=b(()=>c.templates),R=b(()=>{for(const l of c.templates)if(l.newestVersion&&l.newestVersion>l.version)return!0;return!1});U(h,l=>{w.push(`/${y.value}/${l}`)});const D=async({key:l,record:s})=>{var p;const f=d.loading();try{switch(l){case"active":await Z({name:s.template.name}).then(o=>{c.templates=o,d.success("模板已切换")});break;case"update":let e=c.templates[s.templateIndex].controls[1];e.label="更新中..",e.class="txt-grey event-none",await X({productName:s.name}).then(o=>{d.success("更新成功"),c.templates[s.templateIndex].controls[1]=null}).catch(o=>{console.error(o),e.label="更新",e.class=""});break;case"setting":const i=(p=s.template.dhy)==null?void 0:p.link;i?window.open(i):w.push(`/${y.value}/templates/theme/${s.template.name}`);break}}catch(e){console.error(e),d.error((e==null?void 0:e.msg)||(e==null?void 0:e.message)||"操作失败")}finally{f()}};return W(()=>{}),(l,s)=>{const f=L("MIcon"),p=L("RouterLink");return r(),u(k,null,[a(t(j),null,{default:n(()=>[a(t(g),null,{default:n(()=>[a(p,{to:`/${y.value}`},{default:n(()=>[a(f,{name:"dashboard",class:"mr6"}),m("控制台")]),_:1},8,["to"])]),_:1}),a(t(g),null,{default:n(()=>[m("模板管理")]),_:1}),a(t(g),null,{default:n(()=>[m("模板列表")]),_:1})]),_:1}),$("div",O,[a(t(z),{activeKey:h.value,"onUpdate:activeKey":s[0]||(s[0]=e=>h.value=e)},{default:n(()=>[a(t(C),{key:"templates",tab:"模板列表"}),a(t(C),{key:"templates/market"},{tab:n(()=>[R.value?(r(),_(t(q),{key:0,count:"New",numberStyle:{backgroundColor:"var(--success)"},offset:[18,0]},{default:n(()=>[m("模板市场")]),_:1},8,["numberStyle"])):(r(),u(k,{key:1},[m("模板市场")],64))]),_:1})]),_:1},8,["activeKey"]),$("div",Y,[a(t(J),{spinning:P.value,style:{minHeight:"300px",width:"100%"}},{default:n(()=>[v.value.length?(r(),u("div",ee,[(r(!0),u(k,null,H(v.value,(e,i)=>{var o,x,T,I,S,V,E,N;return r(),_(Q,{key:e.name,type:"template",poster:(o=e.dhy)==null?void 0:o.poster,title:(x=e.dhy)==null?void 0:x.title,active:(T=e.dhy)==null?void 0:T.active,auth:(I=e.dhy)==null?void 0:I.auth,description:e.description,version:e.version,tag:e.newestVersion&&e.newestVersion>e.version?"New":"",tagType:"success",controls:[{label:(S=e.dhy)!=null&&S.active?"模板使用中":"设为默认模板",key:"active",class:(V=e.dhy)!=null&&V.active?"txt-grey event-none":"",template:e,templateIndex:i},(E=e.dhy)!=null&&E.linkText||(N=e.dhy)!=null&&N.linkText?{label:e.dhy.linkText||"设置",key:"setting",template:e,templateIndex:i}:null],onClick:D},null,8,["poster","title","active","auth","description","version","tag","controls"])}),128))])):(r(),_(t(M),{key:1,image:t(M).PRESENTED_IMAGE_SIMPLE,description:"暂无模板"},null,8,["image"]))]),_:1},8,["spinning"])])])],64)}}};export{ce as default};
