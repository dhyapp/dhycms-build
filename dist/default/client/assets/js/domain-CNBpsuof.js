import{_ as G,a as H}from"./editModal-B45QIOyg.js";import{c as D}from"./index-fks0TXNb.js";import{j as P}from"./coms-BJ4SXf9r.js";import{I as Q,h as q,A as J,l as p,k as W,T as X}from"./ant2-F-VMf9eP.js";import{bP as $,bQ as Z,bT as b,aM as ee,by as ae,bK as j,aA as m,bH as te,bG as h}from"./ant1-FgANxHEo.js";import{f as r,r as L,p as oe,o as ne,a6 as R,V as C,W as S,k as e,$ as o,u as a,G as s,X as A,a1 as I,F as M}from"./vue-DoSrNxHp.js";const le={class:"pannel pt20 pl20 pb20 pr20 mt14 security-page"},se=A("hr",{class:"mt20 mb20"},null,-1),fe={__name:"domain",setup(ie){const F=r(!1),_=r(!1),u=L({keyword:""}),c=r([]),v=r([]),i=L({current:1,pageSize:20,pageSizeOptions:[20,50,200,500],total:0,showQuickJumper:!0,position:["bottomCenter"]}),w=r(!1),f=r(!1),g=r([]),x=r({}),T={all:"所有",selfreg:"自助收录",comment:"评论",user:"用户"};oe("mapTypes",T);const z=t=>{x.value=t||{}},d=async()=>{try{_.value=!0;const t={current:i.current,pageSize:i.pageSize,fieldby:[],field:[]};u.keyword&&(t.keywordby="ip",t.keyword=u.keyword),t.fieldby=t.fieldby.join(","),t.field=t.field.join(","),v.value=[],await D.list({query:t}).then(l=>{v.value=l.list||[],i.total=l.total})}finally{_.value=!1}},B=async t=>{te.confirm({title:"确认移除？",content:"移除对象将从域名黑名单中剔除",centered:!0,onOk:async()=>new Promise((l,k)=>{D.del({ids:t}).then(()=>{h.success("移除成功"),d(),l()}).catch(y=>{console.error(y),h.error(y.message||"移除失败"),k()})})})},K=t=>{c.value=t},V=async({key:t})=>{if(!c.value.length&&t!=="import")return h.error("未选中目标");switch(t){case"remove":await B(c.value);break;case"set":z(),g.value=c.value,f.value=!0;break}},Y=()=>{i.current=1,d()},E=()=>{u.keyword="",i.current=1,d()},N=(t,l)=>{i.current=t.current,i.pageSize=t.pageSize,d()},O=t=>{z(t),g.value=[t._id],f.value=!0};return ne(()=>{d()}),(t,l)=>{const k=R("MIcon"),y=R("RouterLink");return C(),S(M,null,[e(a(Z),null,{default:o(()=>[e(a($),null,{default:o(()=>[e(y,{to:`/${t.preadmin}`},{default:o(()=>[e(k,{name:"dashboard",class:"mr6"}),s("控制台")]),_:1},8,["to"])]),_:1}),e(a($),null,{default:o(()=>[s("域名黑名单")]),_:1})]),_:1}),A("div",le,[e(a(q),{justify:"space-between"},{default:o(()=>[e(a(b),{wrap:""},{default:o(()=>[e(a(ee),{loading:F.value},{overlay:o(()=>[e(a(ae),{onClick:V},{default:o(()=>[e(a(j),{key:"set"},{default:o(()=>[s("设置")]),_:1}),e(a(j),{key:"remove"},{default:o(()=>[s("移除黑名单")]),_:1})]),_:1})]),default:o(()=>[s(" 批量操作 ")]),_:1},8,["loading"]),e(a(m),{type:"primary",onClick:l[0]||(l[0]=()=>w.value=!0)},{default:o(()=>[s("添加黑名单")]),_:1})]),_:1}),e(a(b),{wrap:""},{default:o(()=>[e(a(Q),{value:u.keyword,"onUpdate:value":l[1]||(l[1]=n=>u.keyword=n),placeholder:"请输入域名"},null,8,["value"]),e(a(m),{type:"primary",onClick:Y},{default:o(()=>[s("搜索")]),_:1}),e(a(m),{onClick:E},{default:o(()=>[s("重置")]),_:1})]),_:1})]),_:1}),se,e(a(J),{type:"warning",message:"以下黑名单均对所有站点生效",showIcon:"",class:"mb12"}),e(a(X),{"data-source":v.value,size:"small",loading:_.value,pagination:i,"row-selection":{selectedRowKeys:c.value,onChange:K},rowKey:"_id",onChange:N},{default:o(()=>[e(a(p),{title:"域名",dataIndex:"domain"}),e(a(p),{title:"类型",dataIndex:"type"},{default:o(({record:n})=>[s(I(T[n.type]),1)]),_:1}),e(a(p),{title:"拉黑时间",dataIndex:"_id"},{default:o(({record:n})=>[s(I(a(P)(n._id)),1)]),_:1}),e(a(p),{title:"自动移除时间",dataIndex:"_id"},{default:o(({record:n})=>[n.expireTime?(C(),S(M,{key:0},[s(I(a(W)(n.expireTime).format("YYYY-MM-DD")),1)],64)):(C(),S(M,{key:1},[s("持久拉黑")],64))]),_:1}),e(a(p),{title:"操作",align:"right"},{default:o(({record:n})=>[e(a(b),null,{default:o(()=>[e(a(m),{size:"small",type:"primary",onClick:U=>O(n)},{default:o(()=>[s("设置")]),_:2},1032,["onClick"]),e(a(m),{size:"small",danger:"",onClick:U=>B([n._id])},{default:o(()=>[s("移除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading","pagination","row-selection"])]),e(G,{show:w.value,"onUpdate:show":l[2]||(l[2]=n=>w.value=n),type:"domain",title:"添加域名黑名单",onSuccess:d},null,8,["show"]),e(H,{show:f.value,"onUpdate:show":l[3]||(l[3]=n=>f.value=n),type:"domain",ids:g.value,data:x.value,title:"设置域名黑名单",onSuccess:d},null,8,["show","ids","data"])],64)}}};export{fe as default};
