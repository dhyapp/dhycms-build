import{a as M}from"./index-fks0TXNb.js";import{u as X,l as B,j as Z}from"./coms-BJ4SXf9r.js";import{bP as L,bQ as ee,bT as T,aM as te,by as $,bK as y,aA as g,bN as ae,bO as se,ae as ne,aL as le,bG as h,bH as oe}from"./ant1-FgANxHEo.js";import{I as ie,h as de,T as re}from"./ant2-F-VMf9eP.js";import{c as ue,r as O,f as w,P as ce,a6 as j,n as pe,V as i,W as r,k as a,$ as e,u as t,G as l,X as b,F as p,a7 as fe,a1 as u,m as me,Z as F,ab as _e,a2 as ye}from"./vue-DoSrNxHp.js";const he={class:"pannel pt20 pl20 pb20 pr20 mt14 ads-list-page"},ke=b("span",{class:"txt-error"},"删除",-1),xe=b("hr",{class:"mt20 mb20"},null,-1),ge={key:0,class:"f ac jc"},be={key:0,class:"poster"},ve={key:1},we=["href"],Ie=b("span",{class:"txt-error"},"删除",-1),ze={__name:"index",setup(Se){const N=X(),I=ue(()=>N.preadmin),c=O({keyword:"",status:null}),D={on:"上线",off:"下线",auto:"自动"},R={on:"success",off:"error",auto:"info"},V={banner:"首页横幅"},K={cpc:"单次点击",cpt:"时长付费",cpm:"展示付费"},S=w([]),C=w(!1),f=O({current:1,pageSize:20,pageSizeOptions:[20,50,200,500],total:0,showQuickJumper:!0,position:["bottomCenter"]}),_=w([]),P=w(!1),G=s=>{_.value=s},H=()=>{f.current=1,f.total=0},k=async()=>{try{C.value=!0;const s={current:f.current,pageSize:f.pageSize,fieldby:[],field:[]};c.status&&(s.fieldby.push("status"),s.field.push(c.status)),c.keyword&&(s.keywordby="name,link",s.keyword=c.keyword),s.fieldby=s.fieldby.join(","),s.field=s.field.join(","),S.value=[],await M.list({query:s}).then(d=>{S.value=d.list||[],f.total=d.total})}finally{C.value=!1}},Y=()=>{k()},z=async s=>{oe.confirm({title:"确认删除？",content:"删除后将无法恢复",centered:!0,onOk:async()=>new Promise((d,x)=>{M.del({ids:s}).then(()=>{h.success("删除成功"),Y(),d()}).catch(m=>{console.error(m),h.error(m.message||"删除失败"),x()})})})},v=async(s,d)=>{const x=h.loading();try{await M.update({ids:s,body:d}).then(()=>{h.success("操作成功"),Y()}).catch(m=>{console.error(m),h.error("操作失败")})}finally{x()}},A=async({key:s},d)=>{switch(s){case"on":v([d._id],{status:"on"});break;case"off":v([d._id],{status:"off"});break;case"del":z([d._id]);break}},Q=async({key:s})=>{if(!_.value.length&&s!=="import")return h.error("未选中目标");switch(s){case"del":await z(_.value);break;case"on":v(_.value,{status:"on"});break;case"off":v(_.value,{status:"off"});break}},U=()=>{k()},q=()=>{c.keyword="",c.status=null,H(),k()},E=s=>{f.current=s.current,f.pageSize=s.pageSize,k()};return ce(()=>{k()}),(s,d)=>{const x=j("MIcon"),m=j("RouterLink"),J=pe("depic");return i(),r(p,null,[a(t(ee),null,{default:e(()=>[a(t(L),null,{default:e(()=>[a(m,{to:`/${I.value}`},{default:e(()=>[a(x,{name:"dashboard",class:"mr6"}),l("控制台")]),_:1},8,["to"])]),_:1}),a(t(L),null,{default:e(()=>[l("广告管理")]),_:1})]),_:1}),b("div",he,[a(t(de),{justify:"space-between"},{default:e(()=>[a(t(T),{wrap:""},{default:e(()=>[a(t(te),{loading:P.value},{overlay:e(()=>[a(t($),{onClick:Q},{default:e(()=>[a(t(y),{key:"on"},{default:e(()=>[l("上线")]),_:1}),a(t(y),{key:"off"},{default:e(()=>[l("下线")]),_:1}),a(t(y),{key:"del"},{default:e(()=>[ke]),_:1})]),_:1})]),default:e(()=>[l(" 批量操作 ")]),_:1},8,["loading"]),a(m,{to:`/${I.value}/ads/edit`},{default:e(()=>[a(t(g),{type:"primary"},{default:e(()=>[l("添加广告")]),_:1})]),_:1},8,["to"])]),_:1}),a(t(T),{wrap:""},{default:e(()=>[a(t(ae),{value:c.status,"onUpdate:value":d[0]||(d[0]=o=>c.status=o),placeholder:"广告状态筛选",style:{width:"160px"}},{default:e(()=>[(i(),r(p,null,fe(D,(o,n)=>a(t(se),{key:n,value:n},{default:e(()=>[l(u(o),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),a(t(ie),{value:c.keyword,"onUpdate:value":d[1]||(d[1]=o=>c.keyword=o),placeholder:"名称/链接/关键词"},null,8,["value"]),a(t(g),{type:"primary",onClick:U},{default:e(()=>[l("搜索")]),_:1}),a(t(g),{onClick:q},{default:e(()=>[l("重置")]),_:1})]),_:1})]),_:1}),xe,a(t(re),{columns:[{title:"广告图",dataIndex:"imgurl",align:"center",width:80},{title:"名称",dataIndex:"name",ellipsis:!0},{title:"链接",dataIndex:"link",ellipsis:!0},{title:"广告位",dataIndex:"position"},{title:"广告文案",dataIndex:"text",ellipsis:!0,width:210},{title:"付费模式",dataIndex:"mode"},{title:"预付款",dataIndex:"prepay"},{title:"单价",dataIndex:"price"},{title:"上线时间",dataIndex:"startTime",width:150},{title:"下线时间",dataIndex:"offTime",width:150},{title:"添加时间",dataIndex:"_id",width:140},{title:"状态",dataIndex:"status",align:"center",fixed:"right",width:80},{title:"操作",dataIndex:"ctrl",align:"right",fixed:"right",width:210}],"data-source":S.value,size:"small",loading:C.value,pagination:f,"row-selection":{selectedRowKeys:_.value,onChange:G},rowKey:"_id",scroll:{x:1800},onChange:E},{bodyCell:e(({column:o,record:n})=>[o.dataIndex==="imgurl"?(i(),r("div",ge,[n.imgurl?(i(),r("div",be,[me(b("img",null,null,512),[[J,`${n.imgurl}?0x30`]])])):(i(),r("span",ve,"-"))])):o.dataIndex==="link"?(i(),r("a",{key:1,href:n.link,rel:"noreferrer",target:"_blank"},u(n.link),9,we)):o.dataIndex==="position"?(i(),r(p,{key:2},[l(u(V[n.position]||"-"),1)],64)):o.dataIndex==="text"?(i(),F(t(ne),{key:3,title:n.text},{default:e(()=>[l(u(n.text||"-"),1)]),_:2},1032,["title"])):o.dataIndex==="mode"?(i(),r(p,{key:4},[l(u(K[n.mode]||"-"),1)],64)):o.dataIndex==="prepay"?(i(),r(p,{key:5},[l(u(n.prepay||0),1)],64)):o.dataIndex==="price"?(i(),r(p,{key:6},[l(u(n.price||0),1)],64)):o.dataIndex==="startTime"?(i(),r(p,{key:7},[l(u(n.startTime?t(B)(n.startTime,"YYYY-MM-DD hh:mm:ss"):"-"),1)],64)):o.dataIndex==="offTime"?(i(),r(p,{key:8},[l(u(n.offTime?t(B)(n.offTime,"YYYY-MM-DD hh:mm:ss"):"-"),1)],64)):o.dataIndex==="_id"?(i(),r(p,{key:9},[l(u(t(Z)(n._id,"YYYY-MM-DD hh:mm")),1)],64)):o.dataIndex==="status"?(i(),r("span",{key:10,class:_e([`sugar-${R[n.status]}`])},u(D[n.status]),3)):o.dataIndex==="ctrl"?(i(),F(t(T),{key:11},{default:e(()=>[a(m,{to:`/${I.value}/ads/edit/${n._id}`},{default:e(()=>[a(t(g),{type:"primary",size:"small"},{default:e(()=>[l("编辑")]),_:1})]),_:2},1032,["to"]),a(t(le),null,{overlay:e(()=>[a(t($),{onClick:W=>A(W,n)},{default:e(()=>[a(t(y),{key:"on"},{default:e(()=>[l("上线")]),_:1}),a(t(y),{key:"off"},{default:e(()=>[l("下线")]),_:1}),a(t(y),{key:"del"},{default:e(()=>[Ie]),_:1})]),_:2},1032,["onClick"])]),default:e(()=>[a(t(g),{size:"small"},{default:e(()=>[l("...")]),_:1})]),_:2},1024)]),_:2},1024)):ye("",!0)]),_:1},8,["data-source","loading","pagination","row-selection"])])],64)}}};export{ze as default};
