import{_ as A}from"./edit-EraRTUSp.js";import{u as G,t as V}from"./coms-BGBaUFfq.js";import{a4 as D,c as O,f as i,p as Q,w as W,o as X,a6 as B,V as u,W as y,X as v,k as e,$ as t,u as s,G as p,F as $,a7 as Z,a1 as g,a2 as C,ab as H,Z as M}from"./vue-DoSrNxHp.js";import{m as P}from"./index-EJK1-8dv.js";import{bP as z,bQ as J,bU as Y,bV as ee,bN as ae,bO as te,aA as w,bT as se,bG as le}from"./ant1-FgANxHEo.js";import{h as ne,P as oe,T as ie}from"./ant2-F-VMf9eP.js";const ue={class:"menu-page"},de={class:"pannel mt14"},pe={class:"f jc tab-panne"},re={class:"max"},me={key:0,class:"f ac nowrap"},ce={key:0,class:"fs12 txt-grey ml6"},Te={__name:"index",setup(ye){const S=D(),N=G(),U=O(()=>N.preadmin),d=i("main"),f=i([]),_=i({}),r=i(!1),k=i("add"),T=i([]);i(null);const I=i({}),L=i([]),x=i(!1),h={nav:"导航",post:"文章",app:"APP",link:"URL",ad:"广告横幅"},q={nav:"grey",post:"grey",link:"success",ad:"primary",app:"grey"};Q("mapSubType",h);const m=async o=>{x.value=!0;const l={sortby:"sort",fieldby:"type",field:o||d.value,pageSize:1e3};f.value.length&&(l.fieldby+=",subType",l.field+=`,in:${f.value.join("|")}`),await P.list({query:l}).then(c=>{var b;o==="category"?((b=c.list)==null||b.forEach(a=>{I.value[a._id]=a}),L.value=V({data:c.list})):T.value=V({data:c.list})}),x.value=!1};W(d,o=>{m()});const E=()=>{k.value="add",_.value={},r.value=!0},F=o=>{k.value="edit",_.value=o,r.value=!0},K=async o=>{try{o.loading=!0,await P.del({id:o._id}).then(()=>{le.success("删除成功"),m()})}finally{o.loading=!1}},R=()=>{m()};return X(()=>{S.query.type?d.value=S.query.type||"main":m()}),(o,l)=>{const c=B("MIcon"),b=B("RouterLink");return u(),y($,null,[v("div",ue,[e(s(J),null,{default:t(()=>[e(s(z),null,{default:t(()=>[e(b,{to:`/${U.value}`},{default:t(()=>[e(c,{name:"dashboard",class:"mr6"}),p("控制台")]),_:1},8,["to"])]),_:1}),e(s(z),null,{default:t(()=>[p("菜单分类")]),_:1})]),_:1}),v("div",de,[e(s(ee),{activeKey:d.value,"onUpdate:activeKey":l[0]||(l[0]=a=>d.value=a)},{default:t(()=>[e(s(Y),{key:"main",tab:"导航分类"})]),_:1},8,["activeKey"]),v("div",pe,[v("div",re,[e(s(ne),{gap:"10",justify:"space-between",class:"mb14"},{default:t(()=>[e(s(ae),{value:f.value,"onUpdate:value":l[1]||(l[1]=a=>f.value=a),mode:"multiple",placeholder:"请选择菜单类型",style:{width:"360px"},onChange:R},{default:t(()=>[(u(),y($,null,Z(h,(a,n)=>e(s(te),{value:n},{default:t(()=>[p(g(a),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),e(s(w),{type:"primary",onClick:E},{default:t(()=>[p("添加菜单")]),_:1})]),_:1}),e(s(ie),{columns:[{title:"名称",dataIndex:"name",width:180},{title:"类型",dataIndex:"subType",width:140},{title:"链接",dataIndex:"link",ellipsis:!0},{title:"操作",dataIndex:"ctrl",align:"right"}],"data-source":T.value,rowKey:"_id",size:"small",loading:x.value,pagination:!1},{bodyCell:t(({column:a,record:n})=>[a.dataIndex==="name"?(u(),y("div",me,[v("span",null,g(n.name),1),n.alias?(u(),y("span",ce,g(n.alias),1)):C("",!0)])):a.dataIndex==="subType"?(u(),y("span",{key:1,class:H(`sugar-${q[n.subType]}`)},g(h[n.subType]),3)):a.dataIndex==="ctrl"?(u(),M(s(se),{key:2},{default:t(()=>[e(s(w),{type:"primary",size:"small",onClick:j=>F(n)},{default:t(()=>[p("编辑")]),_:2},1032,["onClick"]),e(s(oe),{title:"确认删除？",okText:"删除",cancelText:"取消","ok-button-props":{loading:n.loading},onConfirm:j=>K(n)},{default:t(()=>[e(s(w),{size:"small",loading:n.loading},{default:t(()=>[p("删除")]),_:2},1032,["loading"])]),_:2},1032,["ok-button-props","onConfirm"])]),_:2},1024)):C("",!0)]),_:1},8,["data-source","loading"])])])])]),r.value?(u(),M(A,{key:0,modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=a=>r.value=a),state:_.value,type:k.value,menuType:d.value,menuList:T.value,categories:L.value,mapCategories:I.value,onModified:l[3]||(l[3]=()=>m())},null,8,["modelValue","state","type","menuType","menuList","categories","mapCategories"])):C("",!0)],64)}}};export{Te as default};
