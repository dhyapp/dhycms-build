import{a as Q,b as W,L as X,c as Z,g as H,d as J}from"./websites-B5Rghawi.js";import{u as Y,n as j,m as ee}from"./coms-BJ4SXf9r.js";import{f as b,e as L,w as F,o as U,V as y,W as S,X as e,G as d,k as o,$ as c,F as B,a7 as R,u as t,Z as V,a1 as u,af as ae,c as se,a4 as te,p as M,r as le,a6 as N,ab as A,a2 as q}from"./vue-DoSrNxHp.js";import{I as oe,T as ne,R as ie,b as re}from"./ant2-F-VMf9eP.js";import{bO as G,bN as z,bG as I,bP as P,bQ as ue,bT as ce,bD as ve}from"./ant1-FgANxHEo.js";import"./echarts-DiVigrGS.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./dayjs-DxRvC2UW.js";const de={class:"metric-page metric-pages"},me={class:"head f ac je mb20"},pe={__name:"index",setup(K){const m=b(null),f=b(""),C=b([]),$=b(!1),r=L("timekey"),p=L("customDate"),x=L("curMetric"),g=L("metricsPage"),a=async()=>{try{$.value=!0;const n={type:x.value};r.value==="custom"?(n.startAt=p.value[0].valueOf(),n.endAt=p.value[1].valueOf()):n.timeType=r.value,f.value&&m.value&&(n[m.value]=f.value),await Q(n).then(v=>{v&&(C.value=v)})}catch(n){console.error(n),I.error((n==null?void 0:n.msg)||(n==null?void 0:n.message)||"数据概况获取失败")}finally{$.value=!1}},k=ae(()=>{a()},500,{leading:!1}),O=()=>{m.value||(f.value="",k())};return F(x,()=>{f.value="",a()}),F(r,n=>{n!=="custom"&&(f.value="",a())}),U(()=>{a()}),(n,v)=>(y(),S("div",de,[e("div",me,[d(" 筛选： "),o(t(z),{value:m.value,"onUpdate:value":v[0]||(v[0]=h=>m.value=h),allowClear:"",placeholder:"请选择筛选类型",class:"mr10",style:{width:"140px"},onChange:O},{default:c(()=>[(y(!0),S(B,null,R(t(g),(h,D)=>(y(),V(t(G),{key:D,value:D},{default:c(()=>[d(u(h),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),o(t(oe),{value:f.value,"onUpdate:value":v[1]||(v[1]=h=>f.value=h),style:{width:"260px"},placeholder:m.value?`请输入${t(g)[m.value]}`:"请先选择筛选类型",onChange:t(k)},null,8,["value","placeholder","onChange"])]),o(t(ne),{columns:[{title:t(g)[t(x)],dataIndex:"x",ellipsis:!0},{title:"数量",dataIndex:"y",width:200}],"data-source":C.value,size:"small",loading:$.value,pagination:!1},null,8,["columns","data-source","loading"])]))}},_e={class:"pannel mt14 stat-visit-page"},fe={class:"overview f ac jb pt20 pl20 pb20 pr20"},ge={class:"f"},he={class:"itm"},be=e("div",{class:"label"},"访问量",-1),ye={class:"t"},we={class:"itm"},xe=e("div",{class:"label"},"访客",-1),Ce={class:"t"},$e={class:"itm"},ke=e("div",{class:"label"},"跳出率",-1),Oe={class:"t"},Te={class:"itm"},Ae=e("div",{class:"label"},"平均访问时间",-1),Se={class:"t"},De={class:"online-label f ac je mb20"},Le={class:"chart pl20 pr20 mt10"},Me={class:"visit-list pb30 pl20 pr20 f"},Be={class:"metrics"},Ie={class:"fa w0 pl30"},Ge={__name:"index",setup(K){const m=()=>({legend:[],labels:[],series:[],bounces:{value:0,prev:0,ratio:0,rate:0},pageviews:{value:0,prev:0,ratio:0},totaltime:{value:0,prev:0,ratio:0,average:0},visitors:{value:0,prev:0,ratio:0},visits:{value:0,prev:0,ratio:0}}),f=Y(),C=se(()=>f.preadmin),$=te(),r=b("day"),p=b([]),x={day:"今天",week:"本周",month:"本月",week:"本周","24h":"最近24小时","7d":"最近7天","30d":"最近30天","90d":"最近90天",custom:"自定义时间"};M("timekey",r),M("customDate",p);const g=b(!0),a=le(m()),k=b(0),O=b($.params.metric||"url"),n={url:"网页",referrer:"来源域名",event:"行为事件",browser:"浏览器",os:"操作系统",device:"设备",country:"国家",region:"州/省",city:"市/县",language:"语言",screen:"屏幕尺寸",query:"查询参数",host:"访问域名"};M("curMetric",O),M("metricsPage",n);const v=async()=>{const s=I.loading();try{const l={};r.value==="custom"?(l.startAt=p.value[0].valueOf(),l.endAt=p.value[1].valueOf()):l.timeType=r.value,await Z(l).then(i=>{const T=i!=null&&i.visits?i:m();for(const _ in T)a[_]=T[_]})}catch(l){console.error(l),I.error((l==null?void 0:l.msg)||(l==null?void 0:l.message)||"数据概况获取失败")}finally{s()}},h=()=>{if(g.value=!0,r.value==="day")H().then(s=>(g.value=!1,a.legend=["昨日访客","今日访客"],a.labels=new Array(24).fill(0).map((l,i)=>`${i}时`),a.series=(s==null?void 0:s.visitors)||[],s)).catch(s=>{I.error((s==null?void 0:s.msg)||(s==null?void 0:s.message)||"流量概况获取失败")});else{const s={};r.value==="custom"?(s.startAt=p.value[0].startOf("day").valueOf(),s.endAt=p.value[1].endOf("day").valueOf()):s.timeType=r.value,J(s).then(l=>{g.value=!1,a.legend=[`${x[r.value]}访客`],a.labels=l.sessions.map(i=>i.x),a.series=[l.sessions.map(i=>i.y)]})}},D=()=>{r.value!=="custom"&&(v(),h())},E=s=>{s&&(v(),h())};return U(()=>{W().then(s=>k.value=s),v(),h()}),(s,l)=>{const i=N("MIcon"),T=N("RouterLink");return y(),S(B,null,[o(t(ue),null,{default:c(()=>[o(t(P),null,{default:c(()=>[o(T,{to:`/${C.value}`},{default:c(()=>[o(i,{name:"dashboard",class:"mr6"}),d("控制台")]),_:1},8,["to"])]),_:1}),o(t(P),null,{default:c(()=>[d("统计报表")]),_:1}),o(t(P),null,{default:c(()=>[d("访问统计")]),_:1})]),_:1}),e("div",_e,[e("div",fe,[e("div",ge,[e("div",he,[be,e("div",ye,[e("b",null,u(t(j)(a.visits.value)),1)]),e("div",null,[e("b",{class:A([`sugar-${a.visits.ratio>=0?"success":"error"}`])},[o(i,{name:`${a.visits.ratio>=0?"up":"down"}-arrow`,class:"mr4"},null,8,["name"]),d(" "+u(a.visits.ratio)+"% ",1)],2)])]),e("div",we,[xe,e("div",Ce,[e("b",null,u(t(j)(a.visitors.value)),1)]),e("div",null,[e("b",{class:A([`sugar-${a.visitors.ratio>=0?"success":"error"}`])},[o(i,{name:`${a.visitors.ratio>=0?"up":"down"}-arrow`,class:"mr4"},null,8,["name"]),d(" "+u(a.visitors.ratio)+"% ",1)],2)])]),e("div",$e,[ke,e("div",Oe,[e("b",null,u(a.bounces.rate)+"%",1)]),e("div",null,[e("b",{class:A([`sugar-${a.bounces.ratio>=0?"success":"error"}`])},[o(i,{name:`${a.bounces.ratio>=0?"up":"down"}-arrow`,class:"mr4"},null,8,["name"]),d(" "+u(a.bounces.ratio)+"% ",1)],2)])]),e("div",Te,[Ae,e("div",Se,[e("b",null,u(t(ee)(a.totaltime.average,"en")),1)]),e("div",null,[e("b",{class:A([`sugar-${a.totaltime.ratio>=0?"success":"error"}`])},[o(i,{name:`${a.totaltime.ratio>=0?"up":"down"}-arrow`,class:"mr4"},null,8,["name"]),d(" "+u(a.totaltime.ratio)+"% ",1)],2)])])]),e("div",null,[e("div",De,[e("b",null,"当前在线 "+u(k.value)+" 人",1)]),o(t(ce),null,{default:c(()=>[o(t(z),{value:r.value,"onUpdate:value":l[0]||(l[0]=_=>r.value=_),style:{width:"160px"},onChange:D},{default:c(()=>[(y(),S(B,null,R(x,(_,w)=>o(t(G),{key:w,value:w},{default:c(()=>[d(u(_),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),r.value==="custom"?(y(),V(t(ie),{key:0,value:p.value,"onUpdate:value":l[1]||(l[1]=_=>p.value=_),onChange:E},null,8,["value"])):q("",!0)]),_:1})])]),e("div",Le,[o(t(ve),{spinning:g.value,class:"f ac jc",style:{height:"302px",width:"100%"}},{default:c(()=>[g.value?q("",!0):(y(),V(X,{key:0,style:{height:"302px"},legend:a.legend,xAxis:a.labels,series:a.series},null,8,["legend","xAxis","series"]))]),_:1},8,["spinning"]),o(t(re))]),e("div",Me,[e("div",Be,[(y(),S(B,null,R(n,(_,w)=>e("div",{key:w,class:A([{active:O.value===w},"mb4"])},[o(T,{to:`/${C.value}/stat/visit/${w}`,class:"f ac",onClick:()=>O.value=w},{default:c(()=>[d(u(_),1)]),_:2},1032,["to","onClick"])],2)),64))]),e("div",Ie,[o(pe)])])])],64)}}};export{Ge as default};
