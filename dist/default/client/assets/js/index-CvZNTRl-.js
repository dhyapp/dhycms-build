import{_ as E}from"./admin-form-action-bar-CaxKRg0f.js";import{m as H}from"./index-fks0TXNb.js";import{r as q,q as W,u as X,n as O,t as Z}from"./coms-BJ4SXf9r.js";import{g as h}from"./dayjs-DxRvC2UW.js";import{a4 as Y,c as T,r as A,f as i,o as ee,a6 as z,V as S,W as D,k as a,$ as t,u as e,G as l,F as L,a7 as ae,Z as te,a1 as c,X as U,J as ne,af as V}from"./vue-DoSrNxHp.js";import{bP as I,bQ as oe,bT as le,bN as $,bO as b,aA as B,bH as se,bG as ue}from"./ant1-FgANxHEo.js";import{I as de,l as r,T as re}from"./ant2-F-VMf9eP.js";const ie=(v={},y={})=>q(`/api/v1/admin/stats/nav?${W(v)}`,y),ce=(v={})=>q("/api/v1/admin/stats/nav",{method:"POST",body:JSON.stringify(v)}),pe={day:"今日",yesterday:"昨日",beforeyesterday:"前日","3d":"近3日","7d":"近7日",week:"本周",lastweek:"上周","30d":"近30日",month:"本月",lastmonth:"上月"},me={class:"pannel pt20 pl20 pb20 pr20 admin-stat-page"},fe={class:"f fc jc ac pt20 pb20"},Ce={__name:"index",setup(v){const y=Y(),F=X(),G=T(()=>F.preadmin),J=T(()=>!!y.params.code),s=A({date:"yesterday",keyword:y.params.code||"",...h("yesterday")}),w=i(!1),C=i([]),R=i([]),M=i({}),p=A({current:1,pageSize:20,pageSizeOptions:[20,50,200,500],total:0,showQuickJumper:!0,position:["bottomCenter"]}),P=async()=>{const d={sortby:"sort",fieldby:"type,subType",field:"main,nav",pageSize:1e3};await H.list({query:d}).then(o=>{R.value=Z({data:o.list});for(const f of R.value)M.value[f._id]=f.name})},m=async()=>{try{w.value=!0,await ie({current:p.current,pageSize:p.pageSize,...ne(s)}).then(d=>{C.value=d.list||[],p.total=d.total})}finally{w.value=!1}},j=V(async()=>{m()},200,{leading:!1}),N=()=>{const{startAt:d,endAt:o}=h(s.date);s.startAt=d,s.endAt=o,m()},K=()=>{s.keyword="",s.mid=null,s.date="yesterday",p.current=1,p.total=0,C.value=[],N(),m()},_=i(!1),g=i(!1),x=i("day"),Q=V(async()=>{try{g.value=!0;const{startAt:d,endAt:o}=h(x.value);await ce({startAt:d,endAt:o}).then(f=>{const k=Object.keys(f.result).length;ue.success(`同步完成，已同步${k}条数据`),k&&m(),_.value=!1})}finally{g.value=!1}},500,{leading:!1});return ee(()=>{P(),m()}),(d,o)=>{const f=z("MIcon"),k=z("RouterLink");return S(),D(L,null,[a(e(oe),null,{default:t(()=>[a(e(I),null,{default:t(()=>[a(k,{to:`/${G.value}`},{default:t(()=>[a(f,{name:"dashboard",class:"mr6"}),l("控制台")]),_:1},8,["to"])]),_:1}),a(e(I),null,{default:t(()=>[l("统计报表")]),_:1}),a(e(I),null,{default:t(()=>[l("链接报表")]),_:1})]),_:1}),a(E,{class:"mt14",showBack:J.value},{default:t(()=>[a(e(le),{wrap:""},{default:t(()=>[a(e($),{value:s.date,"onUpdate:value":o[0]||(o[0]=n=>s.date=n),placeholder:"请选择日期",style:{width:"120px"},onChange:N},{default:t(()=>[(S(!0),D(L,null,ae(e(pe),(n,u)=>(S(),te(e(b),{key:u,value:u},{default:t(()=>[l(c(n),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),a(e(de),{value:s.keyword,"onUpdate:value":o[1]||(o[1]=n=>s.keyword=n),placeholder:"来源码",allowClear:""},null,8,["value"]),a(e(B),{type:"primary",onClick:e(j)},{default:t(()=>[l("搜索")]),_:1},8,["onClick"]),a(e(B),{onClick:K},{default:t(()=>[l("重置")]),_:1}),a(e(B),{loading:g.value,onClick:o[2]||(o[2]=()=>_.value=!0)},{default:t(()=>[l("日报同步")]),_:1},8,["loading"])]),_:1})]),_:1},8,["showBack"]),U("div",me,[a(e(re),{"data-source":C.value,class:"table-striped",size:"small",loading:w.value,pagination:p,rowKey:"_id",onChange:m},{default:t(()=>[a(e(r),{title:"链接名称",dataIndex:"name"},{default:t(({record:n})=>{var u;return[l(c(((u=n.nav[0])==null?void 0:u.name)||"-"),1)]}),_:1}),a(e(r),{title:"链接",dataIndex:"link"},{default:t(({record:n})=>{var u;return[l(c(((u=n.nav[0])==null?void 0:u.link)||""),1)]}),_:1}),a(e(r),{title:"来源码",dataIndex:"_id"}),a(e(r),{title:"来源UV",dataIndex:"uvCount"}),a(e(r),{title:"来源PV",dataIndex:"pvCount"},{default:t(({record:n})=>[l(c(e(O)(n.pvCount)),1)]),_:1}),a(e(r),{title:"曝光量",dataIndex:"exposureCount"},{default:t(({record:n})=>[l(c(e(O)(n.exposureCount)),1)]),_:1}),a(e(r),{title:"点击量",dataIndex:"clickCount"}),a(e(r),{title:"点击率",dataIndex:"clickRate"},{default:t(({record:n})=>[l(c(n.exposureCount>0?Math.round(n.clickCount/n.exposureCount*1e4)/100:0)+"%",1)]),_:1}),a(e(r),{title:"所属分类",dataIndex:"mid"},{default:t(({record:n})=>{var u;return[l(c(M.value[(u=n.nav[0])==null?void 0:u.mid]||""),1)]}),_:1})]),_:1},8,["data-source","loading","pagination"])]),a(e(se),{open:_.value,"onUpdate:open":o[4]||(o[4]=n=>_.value=n),class:"modal-centered",width:400,centered:"",title:"请选择日报同步时间","ok-button-props":{loading:g.value},onOk:e(Q)},{default:t(()=>[U("div",fe,[a(e($),{value:x.value,"onUpdate:value":o[3]||(o[3]=n=>x.value=n),style:{width:"260px"}},{default:t(()=>[a(e(b),{value:"day"},{default:t(()=>[l("今日")]),_:1}),a(e(b),{value:"yesterday"},{default:t(()=>[l("昨日")]),_:1}),a(e(b),{value:"beforeyesterday"},{default:t(()=>[l("前日")]),_:1})]),_:1},8,["value"])])]),_:1},8,["open","ok-button-props","onOk"])],64)}}};export{Ce as default};
