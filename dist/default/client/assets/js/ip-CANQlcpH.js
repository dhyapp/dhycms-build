import{_ as U,a as G}from"./editModal-B_DPg2wD.js";import{b as P}from"./index-EJK1-8dv.js";import{j as H}from"./coms-BGBaUFfq.js";import{I as Q,h as q,A as J,l as p,k as W,T as X}from"./ant2-F-VMf9eP.js";import{bP as D,bQ as Z,bT as b,aM as ee,by as ae,bK as $,aA as m,bH as te,bG as h}from"./ant1-FgANxHEo.js";import{f as i,r as j,p as oe,o as le,a6 as L,V as I,W as C,k as e,$ as o,u as a,G as n,X as R,a1 as S,F as M}from"./vue-DoSrNxHp.js";const se={class:"pannel pt20 pl20 pb20 pr20 mt14 security-page"},ne=R("hr",{class:"mt20 mb20"},null,-1),fe={__name:"ip",setup(re){const A=i(!1),_=i(!1),d=j({keyword:""}),c=i([]),v=i([]),r=j({current:1,pageSize:20,pageSizeOptions:[20,50,200,500],total:0,showQuickJumper:!0,position:["bottomCenter"]}),w=i(!1),f=i(!1),g=i([]),x=i({}),T={all:"所有",selfreg:"自助收录",comment:"评论",user:"用户"};oe("mapTypes",T);const z=t=>{x.value=t||{}},u=async()=>{try{_.value=!0;const t={current:r.current,pageSize:r.pageSize,fieldby:[],field:[]};d.keyword&&(t.keywordby="ip",t.keyword=d.keyword),t.fieldby=t.fieldby.join(","),t.field=t.field.join(","),v.value=[],await P.list({query:t}).then(s=>{v.value=s.list||[],r.total=s.total})}finally{_.value=!1}},B=async t=>{te.confirm({title:"确认移除？",content:"移除对象将从IP黑名单中剔除",centered:!0,onOk:async()=>new Promise((s,k)=>{P.del({ids:t}).then(()=>{h.success("移除成功"),u(),s()}).catch(y=>{console.error(y),h.error(y.message||"移除失败"),k()})})})},F=t=>{c.value=t},K=async({key:t})=>{if(!c.value.length&&t!=="import")return h.error("未选中目标");switch(t){case"remove":await B(c.value);break;case"set":z(),g.value=c.value,f.value=!0;break}},V=()=>{r.current=1,u()},Y=()=>{d.keyword="",r.current=1,u()},E=(t,s)=>{r.current=t.current,r.pageSize=t.pageSize,u()},N=t=>{z(t),g.value=[t._id],f.value=!0};return le(()=>{u()}),(t,s)=>{const k=L("MIcon"),y=L("RouterLink");return I(),C(M,null,[e(a(Z),null,{default:o(()=>[e(a(D),null,{default:o(()=>[e(y,{to:`/${t.preadmin}`},{default:o(()=>[e(k,{name:"dashboard",class:"mr6"}),n("控制台")]),_:1},8,["to"])]),_:1}),e(a(D),null,{default:o(()=>[n("IP黑名单")]),_:1})]),_:1}),R("div",se,[e(a(q),{justify:"space-between"},{default:o(()=>[e(a(b),{wrap:""},{default:o(()=>[e(a(ee),{loading:A.value},{overlay:o(()=>[e(a(ae),{onClick:K},{default:o(()=>[e(a($),{key:"set"},{default:o(()=>[n("设置")]),_:1}),e(a($),{key:"remove"},{default:o(()=>[n("移除黑名单")]),_:1})]),_:1})]),default:o(()=>[n(" 批量操作 ")]),_:1},8,["loading"]),e(a(m),{type:"primary",onClick:s[0]||(s[0]=()=>w.value=!0)},{default:o(()=>[n("添加黑名单")]),_:1})]),_:1}),e(a(b),{wrap:""},{default:o(()=>[e(a(Q),{value:d.keyword,"onUpdate:value":s[1]||(s[1]=l=>d.keyword=l),placeholder:"请输入IP地址"},null,8,["value"]),e(a(m),{type:"primary",onClick:V},{default:o(()=>[n("搜索")]),_:1}),e(a(m),{onClick:Y},{default:o(()=>[n("重置")]),_:1})]),_:1})]),_:1}),ne,e(a(J),{type:"warning",message:"以下黑名单均对所有站点生效",showIcon:"",class:"mb12"}),e(a(X),{"data-source":v.value,size:"small",loading:_.value,pagination:r,"row-selection":{selectedRowKeys:c.value,onChange:F},rowKey:"_id",onChange:E},{default:o(()=>[e(a(p),{title:"IP",dataIndex:"ip"}),e(a(p),{title:"类型",dataIndex:"type"},{default:o(({record:l})=>[n(S(T[l.type]),1)]),_:1}),e(a(p),{title:"拉黑时间",dataIndex:"_id"},{default:o(({record:l})=>[n(S(a(H)(l._id)),1)]),_:1}),e(a(p),{title:"自动移除时间",dataIndex:"_id"},{default:o(({record:l})=>[l.expireTime?(I(),C(M,{key:0},[n(S(a(W)(l.expireTime).format("YYYY-MM-DD")),1)],64)):(I(),C(M,{key:1},[n("持久拉黑")],64))]),_:1}),e(a(p),{title:"操作",align:"right"},{default:o(({record:l})=>[e(a(b),null,{default:o(()=>[e(a(m),{size:"small",type:"primary",onClick:O=>N(l)},{default:o(()=>[n("设置")]),_:2},1032,["onClick"]),e(a(m),{size:"small",danger:"",onClick:O=>B([l._id])},{default:o(()=>[n("移除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading","pagination","row-selection"])]),e(U,{show:w.value,"onUpdate:show":s[2]||(s[2]=l=>w.value=l),title:"添加IP黑名单",onSuccess:u},null,8,["show"]),e(G,{show:f.value,"onUpdate:show":s[3]||(s[3]=l=>f.value=l),ids:g.value,data:x.value,title:"设置IP黑名单",onSuccess:u},null,8,["show","ids","data"])],64)}}};export{fe as default};
