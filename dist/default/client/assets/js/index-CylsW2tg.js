import{n as C,d as X,u as Z,r as ts,q as es}from"./coms-BGBaUFfq.js";import{ae as F,bD as S,bH as as,bS as T,aA as os,bG as P,bA as H}from"./ant1-FgANxHEo.js";import{e as Q,c as w,a6 as q,V as m,W as y,X as s,k as p,$ as g,a1 as r,u as a,ab as z,f as $,Z as I,l as W,w as ns,o as Y,y as ls,j as is,F as V,a7 as N,p as J,a2 as B,G as k}from"./vue-DoSrNxHp.js";import{L as cs}from"./loading-BEvWhuYv.js";import{u as rs}from"./dhy-gnABKZL-.js";import{a as D}from"./sites-BZ5y2nQR.js";import{e as O,g as ds,L as us}from"./websites-C06P1JJG.js";import{_ as ps}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as _s}from"./system-BsVKZNq-.js";import{g as ms}from"./post-Dhe7dAD5.js";import{s as vs}from"./index-EJK1-8dv.js";import{T as hs}from"./ant2-F-VMf9eP.js";import"./echarts-DiVigrGS.js";import"./dayjs-DxRvC2UW.js";const fs={class:"f ac stat"},gs={class:"f3p f ac itm"},ys={class:"fa w0"},bs=s("div",{class:"txt-cg"},"日访客/日访量",-1),$s={class:"mt6"},ws={class:"fs26"},xs={class:"ml4"},Cs={class:"f3p f ac itm"},Ss={class:"fa w0"},ks=s("div",{class:"txt-cg"},"日收入/总收入",-1),Is={class:"mt6"},Vs={class:"fs26"},Ls={class:"ml4"},As={class:"f3p f ac itm"},Ms={class:"fa w0"},Ts=s("div",{class:"txt-cg"},"已收录/总记录",-1),js={class:"mt6"},zs={class:"fs26"},Ns={class:"ml4"},Rs={class:"tag tag-sm tag-e sugar-warning fs12 ml4"},Es={class:"f3p f ac itm"},Us={class:"fa w0"},Fs=s("div",{class:"txt-cg"},"线上资源总数",-1),Ps={class:"mt6"},Bs={class:"fs26"},Os={__name:"overview",setup(v){const n=Q("overview",{loading:!1}),d=w(()=>{const{yesterdayVisitorSum:l,todayVisitorSum:o}=n.value;if(l){const e=o-l;return Math.round(e/l*1e4)/100}return 0}),i=w(()=>{const{yesterdayIncome:l,todayIncome:o}=n.value;return l?Math.round(o/l*1e4)/100:0}),u=w(()=>{const{selfregInCount:l,selfregCount:o}=n.value;return l?Math.round(l/o*1e4)/100:0});return(l,o)=>{const e=q("MIconJs");return m(),y("div",fs,[s("div",gs,[s("span",null,[p(e,{name:"shujutongji"})]),s("div",ys,[p(a(S),{spinning:a(n).loading},{default:g(()=>[bs,s("div",$s,[s("span",ws,r(a(C)(a(n).todayVisitorSum||0)),1),s("span",xs,"/"+r(a(C)(a(n).todayVisitSum||0)),1),p(a(F),{title:`访客较昨日${d.value<0?"下降"+d.value:"增长"+d.value}%`},{default:g(()=>[s("span",{class:z(`fs12 ml4 ${d.value<0?"txt-error":"txt-success"}`)},r(d.value)+"%",3)]),_:1},8,["title"])])]),_:1},8,["spinning"])])]),s("div",Cs,[s("span",null,[p(e,{name:"yue"})]),s("div",Ss,[p(a(S),{spinning:a(n).loading},{default:g(()=>[ks,s("div",Is,[s("span",Vs,r(a(n).todayIncome||0),1),s("span",Ls,"/"+r(a(C)(a(n).allIncome)||0),1),p(a(F),{title:`较昨日${i.value<0?"下降"+i.value:"增长"+i.value}%`},{default:g(()=>[s("span",{class:z(`fs12 ml4 ${i.value<0?"txt-error":"txt-success"}`)},r(i.value)+"%",3)]),_:1},8,["title"])])]),_:1},8,["spinning"])])]),s("div",As,[s("span",null,[p(e,{name:"sannongzhengce"})]),s("div",Ms,[p(a(S),{spinning:a(n).loading},{default:g(()=>[Ts,s("div",js,[s("span",zs,r(a(C)(a(n).selfregInCount||0)),1),s("span",Ns,"/"+r(a(C)(a(n).selfregCount||0)),1),p(a(F),{title:`收录率${u.value}%`},{default:g(()=>[s("span",Rs,r(`收录率${u.value}%`),1)]),_:1},8,["title"])])]),_:1},8,["spinning"])])]),s("div",Es,[s("span",null,[p(e,{name:"shequ"})]),s("div",Us,[p(a(S),{spinning:a(n).loading},{default:g(()=>[Fs,s("div",Ps,[s("span",Bs,r(a(C)(a(n).postCount||0+a(n).navCount||0)),1)])]),_:1},8,["spinning"])])])])}}},qs=["innerHTML"],j="globalUpdate",Ds={__name:"updateModal",props:{show:Boolean},emits:["update:show"],setup(v,{emit:n}){const d=v,i=n,u=X(),l=w(()=>u.lastestApp),o=Q("systemInfo",{}),e=w({get(){return d.show},set(h){i("update:show",h)}}),b=$(!1),R=w(()=>{if(!o.value.version||!l.value.updateLog)return"";let h="";for(const x in l.value.updateLog)x>o.value.version&&(h+=l.value.updateLog[x]);return h}),L=async()=>{await D().then(()=>{T.destroy({key:j})})},M=()=>{localStorage.setItem("ignoreUpdateVersion",l.value.version)},E=async()=>{e.value=!1,T.open({key:j,message:"系统更新中",description:"系统正在后台更新，请在更新完成后重启",icon:W(cs),duration:null,placement:"bottomRight"}),await rs({productId:l.value.id}).then(()=>{T.success({key:j,message:"系统更新完成",description:"系统最新版本已更新，将在系统下次重启后生效",duration:null,placement:"bottomRight",btn:()=>W(os,{type:"primary",size:"small",onClick:L},"立即重启")})}).catch(h=>{T.error({key:j,message:"系统更新失败",description:`错误信息：${(h==null?void 0:h.msg)||(h==null?void 0:h.messasge)||"系统最新版本已，将在系统下次重启后生效"}`,duration:null,placement:"bottomRight"})})};return(h,x)=>(m(),I(a(as),{open:e.value,"onUpdate:open":x[0]||(x[0]=U=>e.value=U),wrapClassName:"lastestapp-modal",centered:"",title:"导航蚁CMS更新内容",okText:"立即更新",cancelText:"忽略本次更新",confirmLoading:b.value,onCancel:M,onOk:E},{default:g(()=>[s("div",{innerHTML:R.value,class:"scroll"},null,8,qs)]),_:1},8,["open","confirmLoading"]))}},K=({names:v,series:n,isDark:d})=>{const i=["#249EFF","#313CA9","#21CCFF"],u=["#3D72F6","#A079DC","#6CAAF5"];return{legend:{left:"center",data:v,bottom:0,icon:"circle",itemWidth:8,textStyle:{color:d?"#fff":"#4E5969"},itemStyle:{borderWidth:0}},tooltip:{show:!0,trigger:"item"},series:[{type:"pie",radius:["50%","70%"],center:["50%","50%"],label:{formatter:"{d}%",fontSize:14,color:d?"#fff":"#4E5969"},itemStyle:{borderColor:d?"#232324":"#fff",borderWidth:1},data:n.map((o,e)=>{const b=d?u[e]||u[e%u.length]:i[e]||i[e%i.length];return{value:[o],name:v[e],itemStyle:{color:b}}})}]}},Gs={__name:"pie",props:{names:{type:Array,default:()=>[]},series:{type:Array,default:()=>[]}},setup(v){const n=v,d=Z(),i=$(null);let u=K({...n,echarts:O,isDark:d.theme==="dark"}),l;const o=()=>{l.resize()};return ns(()=>d.theme,e=>{u=K({...n,echarts:O,isDark:e==="dark"}),l.setOption(u)}),Y(()=>{ls(()=>{l=O.init(i.value),l.setOption(u),window.addEventListener("resize",o)})}),is(()=>{window.removeEventListener("resize",o)}),(e,b)=>(m(),y("div",{ref_key:"chartRef",ref:i,class:"echarts-area"},null,512))}},Hs=ps(Gs,[["__scopeId","data-v-d3a19a06"]]),Ws={class:"tabs-card"},Js=["onClick"],Ks={__name:"tabs-card",props:{modelValue:{type:[Number,String],default:0},tabs:Array},emits:["update:modelValue","change"],setup(v,{emit:n}){const d=n,i=u=>{d("update:modelValue",u),d("change",u)};return(u,l)=>(m(),y("div",Ws,[(m(!0),y(V,null,N(v.tabs,(o,e)=>(m(),y("div",{key:o.value||e,class:z(["tab",{active:o.value===v.modelValue||e===v.modelValue}]),onClick:b=>i(e)},r(o.name||o),11,Js))),128))]))}},Xs={class:"list-label-item f ac"},Zs={class:"txt-ellipsis-1"},Qs={__name:"list-label",props:{title:String,labels:{type:Array,default:()=>[]}},setup(v){return(n,d)=>(m(),y("div",Xs,[(m(!0),y(V,null,N(v.labels,(i,u)=>(m(),y("label",{key:u,class:z(`sugar-${i.color} fs12`)},r(i.name),3))),128)),s("div",Zs,r(v.title),1)]))}},Ys=(v={},n={})=>ts(`/api/v1/admin/stats/overview?${es(v)}`,{...n}),st={class:"f pagehome"},tt={class:"fa w0"},et={class:"pannel banner"},at={class:"phead"},ot={class:"t"},nt=s("hr",null,null,-1),lt={class:"pbody"},it=s("hr",{class:"mt20"},null,-1),ct=s("div",{class:"head"},"今日流量概况",-1),rt={class:"f as mt16"},dt={class:"f6p pannel"},ut={class:"phead f jb ac"},pt=s("span",{class:"t"},"线上热门内容",-1),_t=["href"],mt={class:"pbody pt0"},vt={class:"f jb ac"},ht={class:"minipagination"},ft={class:"mt16"},gt={class:"fa w0 pannel ml16"},yt=s("div",{class:"phead f jb ac"},[s("span",{class:"t"},"线上内容占比")],-1),bt={class:"f ac jc pb30"},$t={class:"ph-right"},wt={class:"pannel quick-actions"},xt=s("div",{class:"phead f ac jb"},[s("span",{class:"t"},"快捷操作")],-1),Ct={class:"pbody pt0"},St={class:"f fw"},kt={class:"fs12"},It={class:"pannel system-status mt16"},Vt={class:"phead f ac jb"},Lt={class:"f ac"},At=s("span",{class:"t"},"系统状态",-1),Mt=s("span",{class:"sugar-success fs13"},"良好",-1),Tt={class:"pbody f fw fs13"},jt={class:"item"},zt=s("label",{class:"txt-g"},"当前系统：",-1),Nt={class:"item"},Rt=s("label",{class:"txt-g"},"CPU：",-1),Et={class:"item"},Ut=s("label",{class:"txt-g"},"内存：",-1),Ft={class:"item"},Pt=s("label",{class:"txt-g"},"Nginx：",-1),Bt={class:"item"},Ot=s("label",{class:"txt-g"},"Node版本：",-1),qt={class:"item"},Dt=s("label",{class:"txt-g"},"MongoDB：",-1),Gt={class:"item"},Ht=s("label",{class:"txt-g"},"程序：",-1),Wt={class:"pannel system-dynamic mt16"},Jt={class:"phead f ac jb"},Kt=s("span",{class:"t"},"最近收录",-1),Xt=["href"],Zt={class:"pbody pt0 list-label-wrapper"},pe={__name:"index",setup(v){const n=Z(),d=X(),i=w(()=>d.lastestApp),u=w(()=>n.user),l=w(()=>n.preadmin),o=$({loading:!0}),e=$({loading:!0,labels:new Array(24).fill(0).map((t,c)=>`${c}时`),series:[[],[]],todayPerHours:[],todayIncome:0,yesterdayIncome:0,allIncome:0,postCount:0,navCount:0,selfregInCount:0,selfregCount:0});J("overview",e),J("systemInfo",o);const b=$(!1),R=$([{name:"添加链接",icon:"link",href:"nav/edit"},{name:"发布文章",icon:"book-fill",href:"post/edit"},{name:"广告投放",icon:"zhuanzhu",href:"ads/edit"},{name:"访问报表",icon:"group",href:"stat/visit"},{name:"链接报表",icon:"stat",href:"stat/nav"},{name:"广告报表",icon:"coin-fill",href:"stat/ad"}]);$([]);const L=$([{label:"活动",title:"『Javascript之光』限时特惠进行中",labelType:"error"},{label:"消息",title:"新增内容因存在违规词未通过，详情请点击查看",labelType:"warning"},{label:"消息",title:"评论存在违规词，请及时查看处理",labelType:"warning"},{label:"通知",title:"2月份系统升级计划",labelType:"info"},{label:"公告",title:"3月份用户活动计划表",labelType:"info"},{label:"通知",title:"4月份系统升级计划",labelType:"info"},{label:"公告",title:"5月份用户活动计划表",labelType:"info"}]),M=$([]),E=(t="viewCount")=>{ms({pageSize:6,sortby:t}).then(c=>{var _;M.value=(_=c==null?void 0:c.result)==null?void 0:_.map((A,f)=>({id:A.id,sort:f+1,title:A.title,viewCount:C(A.viewCount)}))})},h={out:"未收录",in:"已收录",refuse:"拒绝",block:"拉黑"},x={out:"info",in:"success",refuse:"error",block:"grey"},U=()=>{vs.list({pageSize:10}).then(t=>{var c;L.value=((c=t==null?void 0:t.list)==null?void 0:c.map(_=>({labels:[{name:h[_.status],color:x[_.status]},{name:`来源${_.referrerCount||0}`,color:"grey"}],title:_.name})))||[]}).catch(t=>{P.error((t==null?void 0:t.msg)||(t==null?void 0:t.message)||"收录近况获取失败")})},ss=()=>{b.value=!0};return Y(()=>{_s().then(t=>{t.loading=!1,o.value=t||{}}),E(),U(),Promise.allSettled([ds().then(t=>(t&&(e.value.series=(t==null?void 0:t.visitors)||[],e.value.todayVisitorSum=t==null?void 0:t.visitors[1].reduce((c,_)=>c+_),e.value.todayVisitSum=t==null?void 0:t.visits[1].reduce((c,_)=>c+_),e.value.yesterdayVisitorSum=t==null?void 0:t.visitors[0].reduce((c,_)=>c+_),e.value.yesterdayVisitSum=t==null?void 0:t.visits[0].reduce((c,_)=>c+_)),t)).catch(t=>{P.error((t==null?void 0:t.msg)||(t==null?void 0:t.message)||"流量概况获取失败")}),Ys().then(t=>{if(t)for(const c in t)e.value[c]=t[c]}).catch(t=>{P.error((t==null?void 0:t.msg)||(t==null?void 0:t.message)||"资源概览获取失败")})]).then(()=>{e.value.loading=!1,i.value.version&&localStorage.getItem("ignoreUpdateVersion")!==i.value.version&&(b.value=!0)})}),(t,c)=>{const _=q("MIcon"),A=q("RouterLink");return m(),y(V,null,[s("div",st,[s("div",tt,[s("div",et,[s("div",at,[s("span",ot,"欢迎回来！"+r(u.value.nickname||u.value.username),1)]),nt,s("div",lt,[p(Os),it,ct,p(a(S),{spinning:e.value.loading,class:"f ac jc",style:{height:"302px",width:"100%"}},{default:g(()=>[e.value.loading?B("",!0):(m(),I(us,{key:0,style:{height:"302px"},legend:["昨日","今日"],xAxis:e.value.labels,series:e.value.series},null,8,["xAxis","series"]))]),_:1},8,["spinning"])])]),s("div",rt,[s("div",dt,[s("div",ut,[pt,s("a",{href:`/${l.value}/post`,class:"fs13 txt-i"},"查看更多",8,_t)]),s("div",mt,[s("div",vt,[s("div",ht,[p(Ks,{tabs:["文章"]})])]),s("div",ft,[p(a(hs),{columns:[{title:"排名",dataIndex:"sort",width:60},{title:"标题",dataIndex:"title",ellipsis:!0},{title:"阅读量",dataIndex:"viewCount",width:80,align:"center"}],"data-source":M.value,pagination:!1,ellipsis:"",size:"small"},null,8,["data-source"])])])]),s("div",gt,[yt,s("div",bt,[p(a(S),{spinning:e.value.loading,class:"f ac jc",style:{width:"440px",height:"270px"}},{default:g(()=>[e.value.loading?B("",!0):(m(),I(Hs,{key:0,style:{width:"440px",height:"270px"},names:["链接","文章"],series:[e.value.navCount||0,e.value.postCount]},null,8,["series"]))]),_:1},8,["spinning"])])])])]),s("div",$t,[s("div",wt,[xt,s("div",Ct,[s("div",St,[(m(!0),y(V,null,N(R.value,(f,G)=>(m(),I(A,{to:`/${l.value}/${f.href}`,class:"itm f4p"},{default:g(()=>[p(_,{name:f.icon},null,8,["name"]),s("div",kt,r(f.name),1)]),_:2},1032,["to"]))),256))])])]),s("div",It,[p(a(S),{spinning:o.value.loading},{default:g(()=>[s("div",Vt,[s("span",Lt,[At,s("span",{class:"txt-g restart-btn fs13",onClick:c[0]||(c[0]=(...f)=>a(D)&&a(D)(...f))},[p(_,{name:"restart",class:"mr4"}),k("重启系统 ")])]),Mt]),s("div",Tt,[s("div",jt,[zt,s("span",null,r(o.value.os),1)]),s("div",Nt,[Rt,s("span",null,r(o.value.cpu),1)]),s("div",Et,[Ut,s("span",null,r(o.value.usedMemory)+"G/"+r(o.value.memory)+"G",1)]),s("div",Ft,[Pt,k(" "+r(o.value.nginxVersion||"未安装"),1)]),s("div",Bt,[Ot,k(" "+r(o.value.nodeVersion),1)]),s("div",qt,[Dt,k(" "+r(o.value.mongoDB||"未知"),1)]),s("div",Gt,[Ht,s("div",null,[k(" 当前版本 v"+r(o.value.version)+" ",1),i.value.version>o.value.version?(m(),y(V,{key:0},[k(" （最新版本 v"+r(i.value.version)+"） ",1),s("span",{class:"sugar-primary lastestapp-btn",onClick:ss},"点击更新")],64)):B("",!0)])])])]),_:1},8,["spinning"])]),s("div",Wt,[s("div",Jt,[Kt,s("a",{href:`/${l.value}/selfreg`,class:"fs13 txt-i"},"查看更多",8,Xt)]),s("div",Zt,[L.value.length?(m(!0),y(V,{key:0},N(L.value,(f,G)=>(m(),I(Qs,{key:G,labels:f.labels,title:f.title},null,8,["labels","title"]))),128)):(m(),I(a(H),{key:1,image:a(H).PRESENTED_IMAGE_SIMPLE,description:"暂无收录数据"},null,8,["image"]))])])])]),p(Ds,{show:b.value,"onUpdate:show":c[1]||(c[1]=f=>b.value=f)},null,8,["show"])],64)}}};export{pe as default};
