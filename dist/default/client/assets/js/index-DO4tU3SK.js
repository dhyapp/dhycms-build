import{p as x,m as Se}from"./index-EJK1-8dv.js";import{n as Me,a as Fe}from"./nav-BPwF17xb.js";import{u as Ce,n as Le,j as Re,t as Ue}from"./coms-BGBaUFfq.js";import{bP as ee,bQ as Oe,bT as E,aM as ze,by as ae,bK as p,aA as R,bN as te,bO as le,aL as Te,bH as U,bG as u}from"./ant1-FgANxHEo.js";import{I as oe,h as $e,i as Be,T as De,e as H,F as O,j as G}from"./ant2-F-VMf9eP.js";import{c as He,r as I,f as c,P as je,a6 as ne,n as Ne,V as i,W as y,k as a,$ as t,u as e,G as s,X as S,F as g,a7 as se,Z as j,a1 as _,m as qe,a2 as Ve,J as N}from"./vue-DoSrNxHp.js";const Ke={class:"pannel pt20 pl20 pb20 pr20 mt14 post-list-page"},Ye=S("span",{class:"txt-error"},"删除",-1),Ee=S("hr",{class:"mt20 mb20"},null,-1),Ge={key:0,class:"f ac jc"},Pe={key:0,class:"poster"},Ae={key:1},Je=["href"],Qe=S("span",{class:"txt-error"},"删除",-1),oa={__name:"index",setup(We){const P={label:4,wrapper:20},re=Ce(),q=He(()=>re.preadmin),k=I({keyword:"",mid:null}),de={on:"上线",off:"下线"},V=c([]),K=c(!1),b=I({current:1,pageSize:20,pageSizeOptions:[20,50,200,500],total:0,showQuickJumper:!0,position:["bottomCenter"]}),z=c([]),A=c({}),v=c([]),d=c(!1),ue=l=>{v.value=l},ie=()=>{b.current=1,b.total=0},ce=async()=>{const l={sortby:"sort",fieldby:"type,subType",field:"main,post",pageSize:1e3};await Se.list({query:l}).then(o=>{z.value=Ue({data:o.list});for(const r of z.value)A.value[r._id]=r.name})},M=async()=>{try{K.value=!0;const l={current:b.current,pageSize:b.pageSize,fieldby:[],field:[],filter:"-content"};k.mid&&(l.fieldby.push("mid"),l.field.push(k.mid)),k.keyword&&(l.keywordby="name,link",l.keyword=k.keyword),l.fieldby=l.fieldby.join(","),l.field=l.field.join(","),V.value=[],await x.list({query:l}).then(o=>{V.value=o.list||[],b.total=o.total})}finally{K.value=!1}},w=()=>{M()},J=async l=>{U.confirm({title:"确认删除？",content:"删除后将无法恢复",centered:!0,onOk:async()=>new Promise((o,r)=>{x.del({ids:l}).then(()=>{u.success("删除成功"),w(),o()}).catch(f=>{console.error(f),u.error(f.message||"删除失败"),r()})})})},T=async(l,o="off")=>{const r=u.loading();try{await x.update({ids:l,body:{status:o}}).then(()=>{u.success("操作成功"),w()}).catch(f=>{console.error(f),u.error("操作失败")})}finally{r()}},$=c(!1),h=I({tag:"",tagStyles:""}),Q=c(null),fe=async()=>{try{d.value=!0,await Q.value.validate(),await x.update({ids:v.value,body:N(h)}).then(()=>{u.success("标签设置成功"),$.value=!1,h.tag="",w()}).catch(l=>{console.error(l),u.error("标签设置失败")})}finally{d.value=!1}},B=c(!1),F=I({mid:null}),W=c(null),me=async()=>{try{d.value=!0,await W.value.validate(),await x.update({ids:v.value,body:N(F)}).then(()=>{u.success("归类成功"),B.value=!1,F.mid=null,w()}).catch(l=>{console.error(l),u.error("归类失败")})}finally{d.value=!1}},Y=c(!1),C=I({styles:null}),X=c(null),pe=async()=>{try{d.value=!0,await X.value.validate(),await x.update({ids:v.value,body:N(C)}).then(()=>{u.success("样式设置成功"),Y.value=!1,C.styles=null,w()}).catch(l=>{console.error(l),u.error("样式设置失败")})}finally{d.value=!1}},D=c(!1),L=I({remark:null}),Z=c(null),ye=async()=>{try{d.value=!0,await Z.value.validate(),await x.update({ids:v.value,body:N(L)}).then(()=>{u.success("备注设置成功"),D.value=!1,L.remark=null,w()}).catch(l=>{console.error(l),u.error("备注设置失败")})}finally{d.value=!1}},ve=async()=>{try{d.value=!0,await Fe(v.value).then(async l=>{const o=await l.blob(),r=URL.createObjectURL(o),f=document.createElement("a");f.href=r,f.download="导航导出数据.xlsx",f.click(),f.remove()}).catch(l=>{console.error(l),u.error("导出失败")})}finally{d.value=!1}},ke=async l=>{d.value=!0;const o=new FormData;o.append("file",l.target.files[0]);try{await Me(o).then(r=>{u.info(r.msg||`成功导入${r.success}数据，${r.fail}条失败`),w()})}catch(r){console.error(r),u.error(r.msg||r.mesage||"导入失败")}finally{d.value=!1,l.target.value=null}},_e=async({key:l},o)=>{switch(l){case"block":await T([o._id]);break;case"unblock":await T([o._id],"on");break;case"del":J([o._id]);break}},be=async({key:l})=>{if(!v.value.length&&l!=="import")return u.error("未选中目标");switch(l){case"del":await J(v.value);break;case"block":await T(v.value);break;case"unblock":await T(v.value,"on");break;case"tag":$.value=!0;break;case"menu":B.value=!0;break;case"style":showNavStylesModal.value=!0;break;case"remark":D.value=!0;break;case"export":ve();break}},ge=()=>{M()},we=()=>{k.keyword="",k.mid=null,ie(),M()},he=l=>{b.current=l.current,b.pageSize=l.pageSize,M()};return je(()=>{M(),ce()}),(l,o)=>{const r=ne("MIcon"),f=ne("RouterLink"),xe=Ne("depic");return i(),y(g,null,[a(e(Oe),null,{default:t(()=>[a(e(ee),null,{default:t(()=>[a(f,{to:`/${q.value}`},{default:t(()=>[a(r,{name:"dashboard",class:"mr6"}),s("控制台")]),_:1},8,["to"])]),_:1}),a(e(ee),null,{default:t(()=>[s("文章管理")]),_:1})]),_:1}),S("div",Ke,[a(e($e),{justify:"space-between"},{default:t(()=>[a(e(E),{wrap:""},{default:t(()=>[a(e(ze),{loading:d.value},{overlay:t(()=>[a(e(ae),{onClick:be},{default:t(()=>[a(e(p),{key:"tag"},{default:t(()=>[s("添加标签")]),_:1}),a(e(p),{key:"menu"},{default:t(()=>[s("归类")]),_:1}),a(e(p),{key:"style"},{default:t(()=>[s("设置样式")]),_:1}),a(e(p),{key:"remark"},{default:t(()=>[s("设置备注")]),_:1}),a(e(p),{key:"import",class:"batch-import-wrapper"},{default:t(()=>[s("导入"),S("input",{type:"file",onChange:ke},null,32)]),_:1}),a(e(p),{key:"export"},{default:t(()=>[s("导出")]),_:1}),a(e(p),{key:"block"},{default:t(()=>[s("下架")]),_:1}),a(e(p),{key:"unblock"},{default:t(()=>[s("上架")]),_:1}),a(e(p),{key:"del"},{default:t(()=>[Ye]),_:1})]),_:1})]),default:t(()=>[s(" 批量操作 ")]),_:1},8,["loading"]),a(f,{to:`/${q.value}/post/edit`},{default:t(()=>[a(e(R),{type:"primary"},{default:t(()=>[s("添加文章")]),_:1})]),_:1},8,["to"])]),_:1}),a(e(E),{wrap:""},{default:t(()=>[a(e(te),{value:k.mid,"onUpdate:value":o[0]||(o[0]=n=>k.mid=n),placeholder:"所属菜单分类",style:{width:"160px"}},{default:t(()=>[(i(!0),y(g,null,se(z.value,n=>(i(),j(e(le),{key:n._id,value:n._id},{default:t(()=>[s(_(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),a(e(oe),{value:k.keyword,"onUpdate:value":o[1]||(o[1]=n=>k.keyword=n),placeholder:"标题/关键词"},null,8,["value"]),a(e(R),{type:"primary",onClick:ge},{default:t(()=>[s("搜索")]),_:1}),a(e(R),{onClick:we},{default:t(()=>[s("重置")]),_:1})]),_:1})]),_:1}),Ee,a(e(De),{columns:[{title:"封面",dataIndex:"poster",align:"center",width:80},{title:"标题",dataIndex:"title",ellipsis:!0},{title:"作者",dataIndex:"author",ellipsis:!0},{title:"所属分类",dataIndex:"mid"},{title:"标签",dataIndex:"tag"},{title:"累计浏览",dataIndex:"viewCount"},{title:"添加时间",dataIndex:"_id"},{title:"状态",dataIndex:"status",align:"center",fixed:"right",width:80},{title:"操作",dataIndex:"ctrl",align:"right",fixed:"right",width:210}],"data-source":V.value,size:"small",loading:K.value,pagination:b,"row-selection":{selectedRowKeys:v.value,onChange:ue},rowKey:"_id",onChange:he},{bodyCell:t(({column:n,record:m})=>[n.dataIndex==="poster"?(i(),y("div",Ge,[m.poster?(i(),y("div",Pe,[qe(S("img",null,null,512),[[xe,`${m.poster}?0x30`]])])):(i(),y("span",Ae,"-"))])):n.dataIndex==="title"?(i(),y("a",{key:1,href:`/archive/${m.id}`,target:"_blank"},_(m.title),9,Je)):n.dataIndex==="mid"?(i(),y(g,{key:2},[s(_(A.value[m.mid]||"-"),1)],64)):n.dataIndex==="tag"?(i(),y(g,{key:3},[s(_(m.tag||"-"),1)],64)):n.dataIndex==="author"?(i(),y(g,{key:4},[s(_(m.author||"-"),1)],64)):n.dataIndex==="viewCount"?(i(),y(g,{key:5},[s(_(e(Le)(m.viewCount)),1)],64)):n.dataIndex==="_id"?(i(),y(g,{key:6},[s(_(e(Re)(m._id,"YYYY-MM-DD hh:mm")),1)],64)):n.dataIndex==="status"?(i(),j(e(Be),{key:7,bordered:!1,color:m.status==="off"?"error":"success"},{default:t(()=>[s(_(de[m.status]||"上线"),1)]),_:2},1032,["color"])):n.dataIndex==="ctrl"?(i(),j(e(E),{key:8},{default:t(()=>[a(f,{to:`/${q.value}/post/edit/${m._id}`},{default:t(()=>[a(e(R),{type:"primary",size:"small"},{default:t(()=>[s("编辑")]),_:1})]),_:2},1032,["to"]),a(e(Te),null,{overlay:t(()=>[a(e(ae),{onClick:Ie=>_e(Ie,m)},{default:t(()=>[a(e(p),{key:"block"},{default:t(()=>[s("下架")]),_:1}),a(e(p),{key:"unblock"},{default:t(()=>[s("上架")]),_:1}),a(e(p),{key:"del"},{default:t(()=>[Qe]),_:1})]),_:2},1032,["onClick"])]),default:t(()=>[a(e(R),{size:"small"},{default:t(()=>[s("...")]),_:1})]),_:2},1024)]),_:2},1024)):Ve("",!0)]),_:1},8,["data-source","loading","pagination","row-selection"])]),a(e(U),{open:$.value,"onUpdate:open":o[4]||(o[4]=n=>$.value=n),title:"批量修改或添加标签",centered:"",confirmLoading:d.value,onOk:fe},{default:t(()=>[a(e(H),{ref_key:"tagModalFormRef",ref:Q,model:h,"label-col":{span:P.label},"wrapper-col":{span:P.wrapper},class:"mt20"},{default:t(()=>[a(e(O),{label:"标签名",name:"tag",rules:[{required:!0,message:"标签名不能为空"}]},{default:t(()=>[a(e(oe),{value:h.tag,"onUpdate:value":o[2]||(o[2]=n=>h.tag=n),placeholder:"请输入1~2个中文字符或1~4个英文字符"},null,8,["value"])]),_:1}),a(e(O),{label:"标签样式",name:"tagStyles"},{default:t(()=>[a(e(G),{value:h.tagStyles,"onUpdate:value":o[3]||(o[3]=n=>h.tagStyles=n),placeholder:"请输入CSS样式"},null,8,["value"])]),_:1})]),_:1},8,["model","label-col","wrapper-col"])]),_:1},8,["open","confirmLoading"]),a(e(U),{open:B.value,"onUpdate:open":o[6]||(o[6]=n=>B.value=n),title:"批量设置所属分类",centered:"",confirmLoading:d.value,onOk:me},{default:t(()=>[a(e(H),{ref_key:"menuModalFormRef",ref:W,model:F,class:"mt20"},{default:t(()=>[a(e(O),{name:"mid",rules:[{required:!0,message:"请选择所属分类"}]},{default:t(()=>[a(e(te),{value:F.mid,"onUpdate:value":o[5]||(o[5]=n=>F.mid=n),placeholder:"所属菜单分类"},{default:t(()=>[(i(!0),y(g,null,se(z.value,n=>(i(),j(e(le),{key:n._id,value:n._id},{default:t(()=>[s(_(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"]),a(e(U),{open:Y.value,"onUpdate:open":o[8]||(o[8]=n=>Y.value=n),title:"批量设置标题样式",centered:"",confirmLoading:d.value,onOk:pe},{default:t(()=>[a(e(H),{ref_key:"stylesModalFormRef",ref:X,model:C,class:"mt20"},{default:t(()=>[a(e(O),{name:"styles"},{default:t(()=>[a(e(G),{value:C.styles,"onUpdate:value":o[7]||(o[7]=n=>C.styles=n),placeholder:"请输入CSS样式"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"]),a(e(U),{open:D.value,"onUpdate:open":o[10]||(o[10]=n=>D.value=n),title:"批量文章备注",centered:"",confirmLoading:d.value,onOk:ye},{default:t(()=>[a(e(H),{ref_key:"remarkModalFormRef",ref:Z,model:L,class:"mt20"},{default:t(()=>[a(e(O),{name:"remark"},{default:t(()=>[a(e(G),{value:L.remark,"onUpdate:value":o[9]||(o[9]=n=>L.remark=n),placeholder:"请备注"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])],64)}}};export{oa as default};
