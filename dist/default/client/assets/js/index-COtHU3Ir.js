import{n as x,m as xe}from"./index-fks0TXNb.js";import{n as Ie,a as Ce}from"./nav-D3woVRIb.js";import{u as Se,n as D,j as Me,t as Fe}from"./coms-BJ4SXf9r.js";import{bP as X,bQ as Te,bT as V,aM as Le,by as Z,bK as v,aA as I,bN as ee,bO as ae,aL as Re,bH as H,bG as i}from"./ant1-FgANxHEo.js";import{I as te,h as Be,A as ze,i as Ue,T as $e,e as A,F as j,j as le}from"./ant2-F-VMf9eP.js";import{c as Oe,r as L,f as m,P as De,a6 as oe,n as He,V as d,W as c,k as a,$ as t,u as e,G as r,X as C,F as k,a7 as ne,Z as N,a1 as p,m as je,a2 as Ne,J as K}from"./vue-DoSrNxHp.js";const Ye={class:"pannel pt20 pl20 pb20 pr20 mt14 nav-list-page"},qe=C("span",{class:"txt-error"},"删除",-1),Ve=C("hr",{class:"mt20 mb10"},null,-1),Ae={key:0,class:"f ac jc"},Ke={key:0,class:"poster"},Ee={key:1},Ge=["href"],Pe=C("span",{class:"txt-error"},"删除",-1),ta={__name:"index",setup(Je){const E={label:4,wrapper:20},re=Se(),R=Oe(()=>re.preadmin),_=L({keyword:"",mid:null}),se={on:"上线",off:"下线"},Y=m([]),q=m(!1),b=L({current:1,pageSize:20,pageSizeOptions:[20,50,200,500],total:0,showQuickJumper:!0,position:["bottomCenter"]}),B=m([]),G=m({});let S={};const g=m([]),f=m(!1),de=l=>{g.value=l},ue=()=>{b.current=1,b.total=0,S={}},ie=async()=>{const l={sortby:"sort",fieldby:"type,subType",field:"main,nav",pageSize:1e3};await xe.list({query:l}).then(n=>{B.value=Fe({data:n.list});for(const s of B.value)G.value[s._id]=s.name})},M=async()=>{try{q.value=!0;const l={current:b.current,pageSize:b.pageSize,fieldby:[],field:[]};_.mid&&(l.fieldby.push("mid"),l.field.push(_.mid)),_.keyword&&(l.keywordby="name,link",l.keyword=_.keyword),S.order&&(l.sortby=S.field,l.sort=S.order==="ascend"?1:-1),l.fieldby=l.fieldby.join(","),l.field=l.field.join(","),Y.value=[],await x.list({query:l}).then(n=>{Y.value=n.list||[],b.total=n.total})}finally{q.value=!1}},h=()=>{M()},P=async l=>{H.confirm({title:"确认删除？",content:"删除后将无法恢复",centered:!0,onOk:async()=>new Promise((n,s)=>{x.del({ids:l}).then(()=>{i.success("删除成功"),h(),n()}).catch(y=>{console.error(y),i.error(y.message||"删除失败"),s()})})})},z=async(l,n="off")=>{const s=i.loading();try{await x.update({ids:l,body:{status:n}}).then(()=>{i.success("操作成功"),h()}).catch(y=>{console.error(y),i.error("操作失败")})}finally{s()}},U=m(!1),w=L({tag:"",tagStyles:""}),J=m(null),ce=async()=>{try{f.value=!0,await J.value.validate(),await x.update({ids:g.value,body:K(w)}).then(()=>{i.success("标签设置成功"),U.value=!1,w.tag="",h()}).catch(l=>{console.error(l),i.error("标签设置失败")})}finally{f.value=!1}},$=m(!1),F=L({mid:null}),Q=m(null),fe=async()=>{try{f.value=!0,await Q.value.validate(),await x.update({ids:g.value,body:K(F)}).then(()=>{i.success("归类成功"),$.value=!1,F.mid=null,h()}).catch(l=>{console.error(l),i.error("归类失败")})}finally{f.value=!1}},O=m(!1),T=L({styles:null}),W=m(null),ye=async()=>{try{f.value=!0,await W.value.validate(),await x.update({ids:g.value,body:K(T)}).then(()=>{i.success("导航样式设置成功"),O.value=!1,T.styles=null,h()}).catch(l=>{console.error(l),i.error("导航样式设置失败")})}finally{f.value=!1}},me=async()=>{try{f.value=!0,await Ce(g.value).then(async l=>{const n=await l.blob(),s=URL.createObjectURL(n),y=document.createElement("a");y.href=s,y.download="导航导出数据.xlsx",y.click(),y.remove()}).catch(l=>{console.error(l),i.error("导出失败")})}finally{f.value=!1}},pe=async l=>{f.value=!0;const n=new FormData;n.append("file",l.target.files[0]);try{await Ie(n).then(s=>{i.info(s.msg||`成功导入${s.success}数据，${s.fail}条失败`),h()})}catch(s){console.error(s),i.error(s.msg||s.mesage||"导入失败")}finally{f.value=!1,l.target.value=null}},ve=async({key:l},n)=>{switch(l){case"block":await z([n._id]);break;case"unblock":await z([n._id],"on");break;case"del":P([n._id]);break}},ke=async({key:l})=>{if(!g.value.length&&l!=="import")return i.error("未选中目标");switch(l){case"del":await P(g.value);break;case"block":await z(g.value);break;case"unblock":await z(g.value,"on");break;case"tag":U.value=!0;break;case"menu":$.value=!0;break;case"style":O.value=!0;break;case"export":me();break}},_e=()=>{M()},ge=()=>{_.keyword="",_.mid=null,ue(),M()},be=(l,n,s)=>{b.current=l.current,b.pageSize=l.pageSize,S=s,M()};return De(()=>{M(),ie()}),(l,n)=>{const s=oe("MIcon"),y=oe("RouterLink"),we=He("depic");return d(),c(k,null,[a(e(Te),null,{default:t(()=>[a(e(X),null,{default:t(()=>[a(y,{to:`/${R.value}`},{default:t(()=>[a(s,{name:"dashboard",class:"mr6"}),r("控制台")]),_:1},8,["to"])]),_:1}),a(e(X),null,{default:t(()=>[r("链接管理")]),_:1})]),_:1}),C("div",Ye,[a(e(Be),{justify:"space-between"},{default:t(()=>[a(e(V),{wrap:""},{default:t(()=>[a(e(Le),{loading:f.value},{overlay:t(()=>[a(e(Z),{onClick:ke},{default:t(()=>[a(e(v),{key:"tag"},{default:t(()=>[r("添加标签")]),_:1}),a(e(v),{key:"menu"},{default:t(()=>[r("归类")]),_:1}),a(e(v),{key:"style"},{default:t(()=>[r("设置样式")]),_:1}),a(e(v),{key:"import",class:"batch-import-wrapper"},{default:t(()=>[r("导入"),C("input",{type:"file",onChange:pe},null,32)]),_:1}),a(e(v),{key:"export"},{default:t(()=>[r("导出")]),_:1}),a(e(v),{key:"block"},{default:t(()=>[r("下架")]),_:1}),a(e(v),{key:"unblock"},{default:t(()=>[r("取消下架")]),_:1}),a(e(v),{key:"del"},{default:t(()=>[qe]),_:1})]),_:1})]),default:t(()=>[r(" 批量操作 ")]),_:1},8,["loading"]),a(y,{to:`/${R.value}/nav/edit`},{default:t(()=>[a(e(I),{type:"primary"},{default:t(()=>[r("添加导航")]),_:1})]),_:1},8,["to"])]),_:1}),a(e(V),{wrap:""},{default:t(()=>[a(e(ee),{value:_.mid,"onUpdate:value":n[0]||(n[0]=o=>_.mid=o),placeholder:"所属菜单分类",style:{width:"160px"}},{default:t(()=>[(d(!0),c(k,null,ne(B.value,o=>(d(),N(e(ae),{key:o._id,value:o._id},{default:t(()=>[r(p(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),a(e(te),{value:_.keyword,"onUpdate:value":n[1]||(n[1]=o=>_.keyword=o),placeholder:"名称/链接/关键词"},null,8,["value"]),a(e(I),{type:"primary",onClick:_e},{default:t(()=>[r("搜索")]),_:1}),a(e(I),{onClick:ge},{default:t(()=>[r("重置")]),_:1})]),_:1})]),_:1}),Ve,a(e(ze),{message:"此处来源统计需安装并开启【来路自动排序】插件，否则前台无法按照来源量进行自动排序。每日凌晨6点将进行来源统计。",class:"mb14",showIcon:"",type:"warning"}),a(e($e),{columns:[{title:"图标",dataIndex:"logo",align:"center",width:80},{title:"名称",dataIndex:"name",ellipsis:!0},{title:"链接",dataIndex:"link",ellipsis:!0},{title:"所属分类",dataIndex:"mid"},{title:"昨日来源",dataIndex:"referrerYesterdayCount",sorter:!0},{title:"前日来源",dataIndex:"referrerBeforeyesterdayCount",sorter:!0},{title:"累计来源",dataIndex:"referrerTotal",sorter:!0},{title:"来源码",dataIndex:"referrerCode"},{title:"标签",dataIndex:"tag"},{title:"添加时间",dataIndex:"_id"},{title:"状态",dataIndex:"status",align:"center",fixed:"right",width:80},{title:"操作",dataIndex:"ctrl",align:"right",fixed:"right",width:210}],"data-source":Y.value,size:"small",loading:q.value,pagination:b,"row-selection":{selectedRowKeys:g.value,onChange:de},rowKey:"_id",onChange:be},{bodyCell:t(({column:o,record:u})=>[o.dataIndex==="logo"?(d(),c("div",Ae,[u.logo?(d(),c("div",Ke,[je(C("img",null,null,512),[[we,`${u.logo}?0x30`]])])):(d(),c("span",Ee,"-"))])):o.dataIndex==="link"?(d(),c("a",{key:1,href:u.link,rel:"noreferrer",target:"_blank"},p(u.link),9,Ge)):o.dataIndex==="mid"?(d(),c(k,{key:2},[r(p(G.value[u.mid]||"-"),1)],64)):o.dataIndex==="referrerTodayCount"?(d(),c(k,{key:3},[r(p(e(D)(u.referrerTodayCount)),1)],64)):o.dataIndex==="referrerYesterdayCount"?(d(),c(k,{key:4},[r(p(e(D)(u.referrerYesterdayCount)),1)],64)):o.dataIndex==="referrerBeforeyesterdayCount"?(d(),c(k,{key:5},[r(p(e(D)(u.referrerBeforeyesterdayCount)),1)],64)):o.dataIndex==="referrerTotal"?(d(),c(k,{key:6},[r(p(e(D)(u.referrerTotal+u.referrerTodayCount)),1)],64)):o.dataIndex==="referrerCode"?(d(),c(k,{key:7},[r(p(u.referrerCode||"-"),1)],64)):o.dataIndex==="tag"?(d(),c(k,{key:8},[r(p(u.tag||"-"),1)],64)):o.dataIndex==="_id"?(d(),c(k,{key:9},[r(p(e(Me)(u._id,"YYYY-MM-DD")),1)],64)):o.dataIndex==="status"?(d(),N(e(Ue),{key:10,bordered:!1,color:u.status==="on"?"success":"error"},{default:t(()=>[r(p(se[u.status]),1)]),_:2},1032,["color"])):o.dataIndex==="ctrl"?(d(),N(e(V),{key:11},{default:t(()=>[a(y,{to:`/${R.value}/nav/edit/${u._id}`},{default:t(()=>[a(e(I),{type:"primary",size:"small"},{default:t(()=>[r("编辑")]),_:1})]),_:2},1032,["to"]),a(y,{to:`/${R.value}/stat/nav/${u.referrerCode}`},{default:t(()=>[a(e(I),{size:"small"},{default:t(()=>[r("日报")]),_:1})]),_:2},1032,["to"]),a(e(Re),null,{overlay:t(()=>[a(e(Z),{onClick:he=>ve(he,u)},{default:t(()=>[a(e(v),{key:"block"},{default:t(()=>[r("下架")]),_:1}),a(e(v),{key:"unblock"},{default:t(()=>[r("取消下架")]),_:1}),a(e(v),{key:"del"},{default:t(()=>[Pe]),_:1})]),_:2},1032,["onClick"])]),default:t(()=>[a(e(I),{size:"small"},{default:t(()=>[r("...")]),_:1})]),_:2},1024)]),_:2},1024)):Ne("",!0)]),_:1},8,["data-source","loading","pagination","row-selection"])]),a(e(H),{open:U.value,"onUpdate:open":n[4]||(n[4]=o=>U.value=o),title:"批量修改或添加标签",centered:"",confirmLoading:f.value,onOk:ce},{default:t(()=>[a(e(A),{ref_key:"tagModalFormRef",ref:J,model:w,"label-col":{span:E.label},"wrapper-col":{span:E.wrapper},class:"mt20"},{default:t(()=>[a(e(j),{label:"标签名",name:"tag",rules:[{required:!0,message:"标签名不能为空"}]},{default:t(()=>[a(e(te),{value:w.tag,"onUpdate:value":n[2]||(n[2]=o=>w.tag=o),placeholder:"请输入1~2个中文字符或1~4个英文字符"},null,8,["value"])]),_:1}),a(e(j),{label:"标签样式",name:"tagStyles"},{default:t(()=>[a(e(le),{value:w.tagStyles,"onUpdate:value":n[3]||(n[3]=o=>w.tagStyles=o),placeholder:"请输入CSS样式"},null,8,["value"])]),_:1})]),_:1},8,["model","label-col","wrapper-col"])]),_:1},8,["open","confirmLoading"]),a(e(H),{open:$.value,"onUpdate:open":n[6]||(n[6]=o=>$.value=o),title:"批量设置所属分类",centered:"",confirmLoading:f.value,onOk:fe},{default:t(()=>[a(e(A),{ref_key:"menuModalFormRef",ref:Q,model:F,class:"mt20"},{default:t(()=>[a(e(j),{name:"mid",rules:[{required:!0,message:"请选择所属分类"}]},{default:t(()=>[a(e(ee),{value:F.mid,"onUpdate:value":n[5]||(n[5]=o=>F.mid=o),placeholder:"所属菜单分类"},{default:t(()=>[(d(!0),c(k,null,ne(B.value,o=>(d(),N(e(ae),{key:o._id,value:o._id},{default:t(()=>[r(p(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"]),a(e(H),{open:O.value,"onUpdate:open":n[8]||(n[8]=o=>O.value=o),title:"批量设置导航样式",centered:"",confirmLoading:f.value,onOk:ye},{default:t(()=>[a(e(A),{ref_key:"navStylesModalFormRef",ref:W,model:T,class:"mt20"},{default:t(()=>[a(e(j),{name:"styles"},{default:t(()=>[a(e(le),{value:T.styles,"onUpdate:value":n[7]||(n[7]=o=>T.styles=o),placeholder:"请输入CSS样式"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])],64)}}};export{ta as default};
