import{m as x}from"./index-fks0TXNb.js";import{F as p,I as c,e as B}from"./ant2-F-VMf9eP.js";import{ae as V,bN as N,bO as j,bH as q,bG as v}from"./ant1-FgANxHEo.js";import{f as y,e as A,r as R,h as $,a6 as E,V as T,Z as C,$ as n,k as s,u as o,W as G,a7 as D,G as H,a1 as J,F as P,a3 as W,J as h}from"./vue-DoSrNxHp.js";const X={__name:"edit",props:{modelValue:Boolean,menuList:{type:Array,default:()=>[]},type:{type:String,default:"add"},menuType:{type:String,required:!0},state:{type:Object,default:()=>({})},categories:{type:Array,default:()=>[]},mapCategories:{type:Object,default:()=>({})}},emits:["modified","update:modelValue"],setup(b,{emit:F}){const u=b,g=F,I=()=>({name:"",alias:"",subType:null,icon:"",iconType:null,link:"",color:"",sort:null,tag:"",pid:null,_id:null,cids:[]}),m=y(u.modelValue),M=A("mapSubType",{}),k=y(null),t=R({}),r=y(!1),d=y([]),S=l=>{var i;const e=I();for(let a in e)a==="cids"&&((i=l==null?void 0:l.cids)!=null&&i.length)&&(d.value=l.cids.map(f=>{var _;return{value:f,label:(_=u.mapCategories[f])==null?void 0:_.name}})),t[a]=l[a]||e[a]};$(()=>{m.value=u.modelValue,S(u.state)});const w=()=>{m.value=!1,g("update:modelValue",!1)},O=async()=>{if(/[\-|,]/.test(t.alias))return v.error("英文名称存在非法字符");try{r.value=!0,await k.value.validate();const l=h(t);delete l._id,d.value&&(l.cids=d.value.map(e=>e.value)),await x.add({body:{...l,type:u.menuType}}).then(()=>{v.success("添加成功"),g("modified",l),S({}),w()})}finally{r.value=!1}},U=async()=>{if(/[\-|,]/.test(t.alias))return v.error("英文名称存在非法字符");try{r.value=!0,await k.value.validate();const l=h(t);d.value&&(l.cids=d.value.map(e=>e.value)),await x.update({id:l._id,body:l}).then(()=>{v.success("保存成功"),g("modified",l),w()})}finally{r.value=!1}},L=()=>{u.type==="add"?O():U()};return(l,e)=>{const i=E("MIcon");return T(),C(o(q),W({open:m.value,"onUpdate:open":e[5]||(e[5]=a=>m.value=a)},l.$attrs,{centered:"",title:`${b.type==="add"?"添加":"编辑"}菜单`,"cancel-text":"取消","ok-text":b.type==="add"?"添加":"保存",confirmLoading:r.value,width:700,wrapClassName:"menu-modal",onOk:L,onCancel:w}),{default:n(()=>[s(o(B),{ref_key:"formRef",ref:k,model:t,"label-col":{span:4},"wrapper-col":{span:20},class:"pt30 pb20"},{default:n(()=>[s(o(p),{label:"名称",name:"name",rules:[{required:!0,message:"菜单名称不能为空"}]},{default:n(()=>[s(o(c),{placeholder:"菜单名称",value:t.name,"onUpdate:value":e[0]||(e[0]=a=>t.name=a)},null,8,["value"])]),_:1}),s(o(p),{label:"链接",name:"link"},{default:n(()=>[s(o(c),{placeholder:"https链接或站内相对路径",value:t.link,"onUpdate:value":e[1]||(e[1]=a=>t.link=a)},{suffix:n(()=>[s(o(V),{title:"https链接或站内相对路径"},{default:n(()=>[s(i,{name:"help"})]),_:1})]),_:1},8,["value"])]),_:1}),s(o(p),{label:"菜单类型",name:"subType",rules:[{required:!0,message:"请选择菜单类型"}]},{default:n(()=>[s(o(N),{value:t.subType,"onUpdate:value":e[2]||(e[2]=a=>t.subType=a),placeholder:"请选择菜单类型"},{default:n(()=>[(T(!0),G(P,null,D(o(M),(a,f)=>(T(),C(o(j),{value:f},{default:n(()=>[H(J(a),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),s(o(p),{label:"颜色",name:"color"},{default:n(()=>[s(o(c),{placeholder:"颜色",value:t.color,"onUpdate:value":e[3]||(e[3]=a=>t.color=a)},null,8,["value"])]),_:1}),s(o(p),{label:"排序",name:"sort"},{default:n(()=>[s(o(c),{placeholder:"排序",value:t.sort,"onUpdate:value":e[4]||(e[4]=a=>t.sort=a)},{suffix:n(()=>[s(o(V),{title:"数值越高，排序越靠前"},{default:n(()=>[s(i,{name:"help"})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},16,["open","title","ok-text","confirmLoading"])}}};export{X as _};
