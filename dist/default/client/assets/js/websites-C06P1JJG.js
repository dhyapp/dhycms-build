import{A as x,C as L,a as M,b as $,S as C,M as _,P as O,c as P,d as A,e as E,f as z,g as k,h as G,i as V,j as q,k as B,l as U,m as T,n as Y,o as F,p as J,q as R,r as W,s as H,t as N,u as K,v as Q,w as X,x as Z,y as j,z as ee,B as h,D as te,E as ae,F as se,G as ie,H as oe,I as re,J as ne,K as le,L as ce,N as ve,O as ue,Q as pe,R as fe,T as de,U as ge,V as me,W as we,X as ye,Y as I,Z as be,_ as he,$ as De,a0 as Ie,a1 as Se,a2 as xe,a3 as Le,a4 as Me,a5 as $e,a6 as Ce,a7 as _e,a8 as Oe,a9 as Pe,aa as Ae,ab as Ee,ac as ze}from"./echarts-DiVigrGS.js";import{u as p,r as g,q as y}from"./coms-BGBaUFfq.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f as Ge,w as Ve,o as qe,y as Be,j as Ue,V as Te,W as Ye}from"./vue-DoSrNxHp.js";import{g as b}from"./dayjs-DxRvC2UW.js";import{k as m}from"./ant2-F-VMf9eP.js";const w=Object.freeze(Object.defineProperty({__proto__:null,Axis:x,ChartView:L,ComponentModel:M,ComponentView:$,List:C,Model:_,PRIORITY:O,SeriesModel:P,color:A,connect:E,dataTool:z,dependencies:k,disConnect:G,disconnect:V,dispose:q,env:B,extendChartView:U,extendComponentModel:T,extendComponentView:Y,extendSeriesModel:F,format:J,getCoordinateSystemDimensions:R,getInstanceByDom:W,getInstanceById:H,getMap:N,graphic:K,helper:Q,init:X,innerDrawElementOnCanvas:Z,matrix:j,number:ee,parseGeoJSON:h,parseGeoJson:h,registerAction:te,registerCoordinateSystem:ae,registerLayout:se,registerLoading:ie,registerLocale:oe,registerMap:re,registerPostInit:ne,registerPostUpdate:le,registerPreprocessor:ce,registerProcessor:ve,registerTheme:ue,registerTransform:pe,registerUpdateLifecycle:fe,registerVisual:de,setCanvasCreator:ge,setPlatformAPI:me,throttle:we,time:ye,use:I,util:be,vector:he,version:De,zrUtil:Ie,zrender:Se},Symbol.toStringTag,{value:"Module"}));I([xe,Le,Me,$e,Ce,_e,Oe,Pe,Ae,Ee,ze]);const D=({xAxis:o,series:s,echarts:t,isDark:r,legend:n=[]})=>{const a=[{width:3,color:new t.graphic.LinearGradient(0,0,1,0,[{offset:0,color:"rgba(255, 0, 60, .3)"},{offset:.5,color:"rgba(255, 0, 72, .4)"},{offset:1,color:"rgba(255, 0, 72, .5)"}])},{width:3,color:new t.graphic.LinearGradient(0,0,1,0,[{offset:0,color:"rgba(30, 231, 255, 1)"},{offset:.5,color:"rgba(36, 154, 255, 1)"},{offset:1,color:"rgba(111, 66, 251, 1)"}])}],l=[{opacity:.8,color:new t.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(255, 0, 72, .2)"},{offset:1,color:"rgba(255, 0, 72, .01)"}])},{opacity:.8,color:new t.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(17, 126, 255, 0.8)"},{offset:1,color:"rgba(17, 128, 255, 0.1)"}])}],c=["rgba(255, 0, 72, .5)","rgba(111, 66, 251, 1)"];return{legend:{data:n.map((i,u)=>({name:i,itemStyle:{color:c[u]}}))},grid:{left:"40",right:"10",top:n.length?"30":"10",bottom:"20"},xAxis:{type:"category",boundaryGap:!1,data:o,splitLine:{show:!0,interval:i=>!(i===0||i===o.length-1),lineStyle:{color:r?"#333":"#E5E8EF"}}},yAxis:{type:"value",splitLine:{show:!0,lineStyle:{type:"dashed",color:r?"#333":"#E5E8EF"}}},series:s.map((i,u)=>({name:n[u],data:i,type:"line",smooth:!0,emphasis:{focus:"series",itemStyle:{borderWidth:2}},showSymbol:!1,lineStyle:a[u],areaStyle:l[u]}))}},Fe={__name:"line",props:{xAxis:{type:Array,default:()=>[]},series:{type:Array,default:()=>[]},legend:{type:Array,default:()=>[]}},setup(o){const s=o,t=p(),r=Ge(null);let n=D({...s,echarts:w,isDark:t.theme==="dark"}),a;const l=()=>{a.resize()};return Ve(()=>t.theme,c=>{n=D({...s,echarts:w,isDark:c==="dark"}),a.setOption(n)}),qe(()=>{Be(()=>{a=w.init(r.value),a.setOption(n),window.addEventListener("resize",l)})}),Ue(()=>{window.removeEventListener("resize",l)}),(c,e)=>(Te(),Ye("div",{ref_key:"lineChart",ref:r,class:"echarts-line"},null,512))}},Qe=ke(Fe,[["__scopeId","data-v-3516ff63"]]),S="Asia/Shanghai",Xe=()=>new Promise((o,s)=>{const t=p();if(!t.webID)return s({err:1,msg:"未授权webID"});let r=m().subtract(1,"day").startOf("day").valueOf(),n=m().endOf("day").valueOf();g(`/api/v1/admin/stat/websites/${t.webID}/pageviews?startAt=${r}&endAt=${n}&unit=hour&timezone=${S}`).then(a=>{const l=m().format("YYYY-MM-DD"),c=new Array(24).fill(0),e=new Array(24).fill(0),i=new Array(24).fill(0),u=new Array(24).fill(0);for(let v=0;v<a.sessions.length;v++){const f=a.sessions[v].x,d=parseInt(f.match(/.*?\s(\d{2}).*/)[1]);f.includes(l)?c[d]=a.sessions[v].y:e[d]=a.sessions[v].y}for(let v=0;v<a.pageviews.length;v++){const f=a.pageviews[v].x,d=parseInt(f.match(/.*?\s(\d{2}).*/)[1]);f.includes(l)?i[d]=a.pageviews[v].y:u[d]=a.pageviews[v].y}o({visitors:[e,c],visits:[u,i]})}).catch(s)}),Ze=()=>new Promise((o,s)=>{const t=p();if(!t.webID)return s({err:1,msg:"未授权webID"});g(`/api/v1/admin/stat/websites/${t.webID}/active`).then(r=>o((r==null?void 0:r.x)||0)).catch(s)}),je=({timeType:o="day",startAt:s,endAt:t,...r})=>new Promise((n,a)=>{if(!s&&!t){const e=b(o);s=e.startAt,t=e.endAt}const l=p();if(!l.webID)return a({err:1,msg:"未授权webID"});const c={startAt:s,endAt:t,...r};g(`/api/v1/admin/stat/websites/${l.webID}/stats?${y(c)}`).then(e=>{if(e.visits){if(e.visits.value?(e.bounces.rate=Math.round(e.bounces.value/e.visits.value*1e4)/100,e.totaltime.average=Math.round(e.totaltime.value/e.visits.value*10)/10):(e.bounces.rate=0,e.totaltime.average=0),e.visits.prev){e.totaltime.prevaverage=Math.round(e.totaltime.prev/e.visits.prev*10)/10;const i=e.visits.value-e.visits.prev;e.visits.ratio=Math.round(i/e.visits.prev*1e3)/100}else e.visits.ratio=0;if(e.totaltime.prevaverage){const i=e.totaltime.average-e.totaltime.prevaverage;e.totaltime.ratio=Math.round(i/e.totaltime.prevaverage*1e3)/100}else e.totaltime.ratio=0;if(e.bounces.prev){const i=e.bounces.value-e.bounces.prev;e.bounces.ratio=Math.round(i/e.bounces.prev*1e3)/100}else e.bounces.ratio=0;if(e.pageviews.prev){const i=e.pageviews.value-e.pageviews.prev;e.pageviews.ratio=Math.round(i/e.pageviews.prev*1e3)/100}else e.pageviews.ratio=0;if(e.visitors.prev){const i=e.visitors.value-e.visitors.prev;e.visitors.ratio=Math.round(i/e.visitors.prev*1e3)/100}else e.visitors.ratio=0}return n(e),e}).catch(a)}),et=({timeType:o="day",startAt:s,endAt:t})=>new Promise((r,n)=>{if(!s&&!t){const c=b(o);s=c.startAt,t=c.endAt}const a=p();if(!a.webID)return n({err:1,msg:"未授权webID"});const l={startAt:s,endAt:t,timezone:S,unit:o==="day"||o==="24h"?"hour":o==="year"||o==="90d"?"month":"day"};g(`/api/v1/admin/stat/websites/${a.webID}/pageviews?${y(l)}`).then(r).catch(n)}),tt=({timeType:o="day",startAt:s,endAt:t,...r})=>new Promise((n,a)=>{if(!s&&!t){const e=b(o);s=e.startAt,t=e.endAt}const l=p();if(!l.webID)return a({err:1,msg:"未授权webID"});const c={startAt:s,endAt:t,...r};g(`/api/v1/admin/stat/websites/${l.webID}/metrics?${y(c)}`).then(n).catch(a)});export{Qe as L,tt as a,Ze as b,je as c,et as d,w as e,Xe as g};
