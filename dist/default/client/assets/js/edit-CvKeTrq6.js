import{f as p,r as Q,J as c,c as W,ae as X,a4 as Z,p as Y,w as ee,D as te,ag as ae,a6 as L,W as N,k as t,$ as o,u as a,F as $,V as m,G as u,X as n,a1 as D,m as B,ah as F,Z as b,a2 as le,a7 as se}from"./vue-DoSrNxHp.js";import{_ as oe}from"./cloud-poster-upload-DoFHsbIw.js";import{_ as ne}from"./index-DBsdTIEy.js";import{_ as ie}from"./admin-form-action-bar-CaxKRg0f.js";import{_ as ue}from"./edit-Dq4uffTC.js";import{u as de,p as O,t as re}from"./coms-BJ4SXf9r.js";import{p as G,m as pe}from"./index-fks0TXNb.js";import{bP as V,bQ as me,aA as y,bV as fe,bU as ce,bD as ve,ae as _e,bO as be,bN as ye,bA as A,bG as ge,bH as he,n as ke}from"./ant1-FgANxHEo.js";import{F as g,d as we,I as C,f as Se,s as Ie,t as J,j as P,e as Te}from"./ant2-F-VMf9eP.js";import"./modal-HJgcDYUy.js";import"./main-DsqflK1t.js";import"./index-DMU2ysKL.js";const Ve={class:"f ac"},Ce={class:"admin-post-edit-page mt10 f"},Re={class:"fa w0"},Ue={class:"pannel"},Me={class:"pt20 pl20 pr20"},Ee={class:"pannel pannel-post-info mt20"},xe=n("div",{class:"phead"},"文章信息",-1),Le=n("hr",null,null,-1),Ne={class:"pt30 pr20 pb20 pl20 info-body"},$e={class:"right ml20"},De={class:"pannel pt20 pl20 pb20 pr20"},Be=n("div",{class:"mb10"},"封面海报",-1),Fe={class:"pannel pt20 pl20 pb20 pr20 mt20"},Oe={class:"mb10 f jb ac"},Ge={class:"required"},Ae=n("hr",{class:"mb12"},null,-1),Je={class:"pannel pt20 pl20 pb20 pr20 mt20"},Pe=n("div",{class:"mb10"},"标题样式",-1),qe={class:"pannel pt20 pl20 pb20 pr20 mt20"},je=n("div",{class:"mb10"},"标签",-1),ze={class:"pannel pt20 pl20 pb20 pr20 mt20"},Ke=n("div",{class:"mb10"},"备注",-1),ut={__name:"edit",setup(He){const R=()=>({id:O(),author:"",title:"",poster:"",content:"",mid:null,status:"on",tag:"",tagStyles:"",styles:"",remark:""}),v=p(!1),l=Q(R());let h=JSON.stringify(c(l));const q=(i,e)=>{const d=R();for(let r in d)i[r]=(e==null?void 0:e[r])||d[r]},U={label:4,wrapper:20},k=de(),w=W(()=>k.preadmin),j=X(),f=Z(),_=p([]),S=p(!1);Y("mapSubType",{post:"文章类型"});const I=p("content"),z={height:600},M=p(null),E=p(null),T=p(!1),K=i=>G.get({id:i}).then(e=>(v.value=!0,q(l,e),h=JSON.stringify(c(l)),e)),H=async()=>{try{T.value=!0,await E.value.validate();const i={body:c(l)},e=!f.params.id;e||(i.id=f.params.id),await G[e?"add":"update"](i).then(()=>{h=JSON.stringify(c(l)),ge.success(`${e?"发布":"保存"}成功`),j.back()})}finally{T.value=!1}},x=async()=>{pe.list({query:{fieldby:"subType",field:"post",sortby:"sort",pageSize:1e3}}).then(i=>{_.value=re({data:i.list||[]})})};return ee(()=>k.theme,()=>{({content:M})[I.value].value.reload()}),te(()=>{x(),f.params.id?K(f.params.id):v.value=!0}),ae((i,e,d)=>{JSON.stringify(c(l))===h?d():he.confirm({title:"页面数据未保存，确认离开？",icon:t(ke),okText:"留在此页面",cancelText:"离开",onOk(){d(!1)},onCancel(){d()}})}),(i,e)=>{const d=L("MIcon"),r=L("RouterLink");return m(),N($,null,[t(a(me),null,{default:o(()=>[t(a(V),null,{default:o(()=>[t(r,{to:`/${w.value}`},{default:o(()=>[t(d,{name:"dashboard",class:"mr6"}),u("控制台")]),_:1},8,["to"])]),_:1}),t(a(V),null,{default:o(()=>[t(r,{to:`/${w.value}/post`},{default:o(()=>[u("文章管理")]),_:1},8,["to"])]),_:1}),t(a(V),null,{default:o(()=>[u("编辑")]),_:1})]),_:1}),t(a(Te),{ref_key:"formRef",ref:E,model:l,labelCol:{span:U.label},wrapperCol:{span:U.wrapper},labelAlign:"left",class:"mt14"},{default:o(()=>[t(ie,null,{default:o(()=>[n("div",Ve,[t(a(y),{type:"primary",loading:T.value,onClick:e[0]||(e[0]=s=>H(!1))},{default:o(()=>[u(D(a(f).params.id?"保存修改":"发布"),1)]),_:1},8,["loading"])])]),_:1}),n("div",Ce,[n("div",Re,[n("div",Ue,[n("div",Me,[t(a(g),{name:"title",class:"mb0",rules:[{required:!0,message:"标题不能为空"}],wrapperCol:{span:24}},{default:o(()=>[B(n("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.title=s),class:"h1-input",placeholder:"请输入标题"},null,512),[[F,l.title]])]),_:1}),n("div",null,[B(n("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.author=s),class:"author-input",placeholder:"作者"},null,512),[[F,l.author]])])]),t(a(fe),{activeKey:I.value,"onUpdate:activeKey":e[4]||(e[4]=s=>I.value=s)},{default:o(()=>[t(a(ce),{key:"content",tab:"正文"},{default:o(()=>[t(a(ve),{spinning:!v.value,style:{minHeight:"600px"},class:"f ac jc"},{default:o(()=>[v.value?(m(),b(ne,{key:0,ref_key:"editorRef",ref:M,modelValue:l.content,"onUpdate:modelValue":e[3]||(e[3]=s=>l.content=s),dark:a(k).theme==="dark",options:z},null,8,["modelValue","dark"])):le("",!0)]),_:1},8,["spinning"])]),_:1})]),_:1},8,["activeKey"])]),n("div",Ee,[xe,Le,n("div",Ne,[t(a(g),{name:"id",label:"文章ID（唯一）",rules:[{required:!0,message:"ID不能为空"}]},{default:o(()=>[t(a(we),{compact:""},{default:o(()=>[t(a(C),{value:l.id,"onUpdate:value":e[5]||(e[5]=s=>l.id=s),placeholder:"ID自动生成，非必要请勿手动更改"},{suffix:o(()=>[t(a(_e),{title:"ID自动生成，非必要请勿手动更改"},{default:o(()=>[t(d,{name:"info",class:"fs18"})]),_:1})]),_:1},8,["value"]),t(a(y),{onClick:e[6]||(e[6]=()=>l.id=a(O)())},{default:o(()=>[u("重新生成ID")]),_:1})]),_:1})]),_:1}),t(a(g),{name:"view",label:"累计浏览量"},{default:o(()=>[t(a(Se),{value:l.viewCount,"onUpdate:value":e[7]||(e[7]=s=>l.viewCount=s)},null,8,["value"])]),_:1}),t(a(g),{label:"上下线",name:"status"},{default:o(()=>[t(a(Ie),{value:l.status,"onUpdate:value":e[8]||(e[8]=s=>l.status=s)},{default:o(()=>[t(a(J),{value:"on"},{default:o(()=>[u("上线")]),_:1}),t(a(J),{value:"off"},{default:o(()=>[u("下线")]),_:1})]),_:1},8,["value"])]),_:1})])])]),n("div",$e,[n("div",De,[Be,t(oe,{modelValue:l.poster,"onUpdate:modelValue":e[9]||(e[9]=s=>l.poster=s),previewURL:`${l.poster}?280x160`},null,8,["modelValue","previewURL"])]),n("div",Fe,[n("div",Oe,[n("span",Ge,[u("文章分类"),t(a(y),{size:"small",class:"ml6",onClick:e[10]||(e[10]=()=>S.value=!0)},{default:o(()=>[u("添加")]),_:1})]),t(r,{to:`/${w.value}/menu`},{default:o(()=>[t(a(y),{size:"small",type:"link"},{default:o(()=>[u("文章分类管理")]),_:1})]),_:1},8,["to"])]),Ae,_.value.length?(m(),b(a(ye),{key:0,value:l.mid,"onUpdate:value":e[11]||(e[11]=s=>l.mid=s),placeholder:"请选择分类",style:{width:"100%"}},{default:o(()=>[(m(!0),N($,null,se(_.value,s=>(m(),b(a(be),{key:s._id,value:s._id},{default:o(()=>[u(D(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(m(),b(a(A),{key:1,image:a(A).PRESENTED_IMAGE_SIMPLE,description:"暂无分类"},null,8,["image"]))]),n("div",Je,[Pe,t(a(P),{placeholder:"请输入标题css"})]),n("div",qe,[je,t(a(C),{value:l.tag,"onUpdate:value":e[12]||(e[12]=s=>l.tag=s),style:{width:"100%"},placeholder:"请输入1~2中文字符或1~4英文字符"},null,8,["value"]),t(a(P),{placeholder:"请输入标签css",class:"mt14"})]),n("div",ze,[Ke,t(a(C),{value:l.remark,"onUpdate:value":e[13]||(e[13]=s=>l.remark=s),style:{width:"100%"}},null,8,["value"])])])])]),_:1},8,["model","labelCol","wrapperCol"]),t(ue,{modelValue:S.value,"onUpdate:modelValue":e[14]||(e[14]=s=>S.value=s),type:"add",menuType:"main",menuList:_.value,onModified:x},null,8,["modelValue","menuList"])],64)}}};export{ut as default};
