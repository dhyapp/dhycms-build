import{_ as $}from"./modal-DZ8O4vOv.js";import{l as C,d as v}from"./index-DoS9QrfY.js";import{u as E}from"./coms-BGBaUFfq.js";import{f as x,o as B,j,V as w,W as z,X as F,ab as I,k as L,F as V}from"./vue-DoSrNxHp.js";const q=()=>({suffix:".min",language:"zh_CN",language_url:"/assets/tinymce/langs/zh_CN.js",base_url:"/assets/tinymce",relative_urls:!1,document_base_url:"",menubar:!1,default_link_target:"_blank",placeholder:"请输入正文内容",branding:!1,toolbar:"styles bold italic underline strikethrough forecolor backcolor | link unlink alignleft aligncenter numlist bullist emoticons image cloud | code removeformat fullscreen |",plugins:"code emoticons link image lists fullscreen",valid_children:"+div[style]",statusbar:!1}),A=function(r,s){if(s&&s.length){let t="";for(let e of s){let{src:n,blobSrc:u}=e;const m=e.platform==3;switch(e.pid){case"pic":t+=`<img img-lazy class=cf-source src="${u||`${n}?980`}" alt="${e.name}" data-cf=${m?1:0} data-src="${n}?980">`;break;default:t+=`附件:<a class=cf-source target="_blank" href="${n}" data-cf=${m?1:0} data-src="${n}">${e.name}.${e.ext}</a>`}}t&&r.execCommand("mceInsertContent",!1,t)}};let k=!1;const H=()=>new Promise((r,s)=>{if(k)return r();let t=document.querySelector("#tinymce");t||(t=document.createElement("script"),t.id="tinymce",t.src="/assets/tinymce/tinymce.min.js",document.body.append(t));const e=()=>{k=!0,r(),t.removeEventListener("load",e)},n=()=>{s("TinyMCE编辑器加载失败"),t.removeEventListener("error",n)};t.addEventListener("load",e),t.addEventListener("error",n)}),M=["id"],D={__name:"index",props:{modelValue:String,imgBaseUrl:{type:String,default:""},id:{type:String,default:"editor"},imgDomain:{type:String,default:""},options:{type:Object,default:()=>({})},dark:Boolean,placeholder:{type:String,default:"请输入内容"}},emits:["update:modelValue"],setup(r,{expose:s,emit:t}){const e=r,n=t,u=E(),{key:m,staticDomain:b}=u.cloud,f=x(!1);let l;const S=c=>{A(l,c),f.value=!1},h=async()=>{let c='.mce-content-body{font-family: "Open Sans", -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Segoe UI, Arial, Roboto, "PingFang SC", "miui", "Hiragino Sans GB", "Microsoft Yahei", sans-serif;font-size:14px;}';return e.dark&&(c+=".mce-content-body{color:#fff}.mce-content-body[data-mce-placeholder]::before{color:#525252!important}"),new Promise((p,_)=>{tinymce.init({selector:`#${e.id}`,...q(),...e.options,dark:e.dark?"dark":"",placeholder:e.placeholder,content_style:c,setup(i){l=i,l.on("change input undo redo",()=>{let a=l.getContent();if(a){const d=/(<(img|a).*?)\s(src|href)=".*?"(.*?data\-cf=.*?data\-src=.*?>)/g;a=a.replace(d,"$1$4")}n("update:modelValue",a)}),i.ui.registry.addButton("cloud",{tooltip:"云盘",icon:"gallery",onAction:()=>{f.value=!0}})},init_instance_callback(i){i.setContent(e.modelValue);let a=[],d=[];if(e.options.inline)a=document.querySelectorAll("img.cf-source"),d=document.querySelectorAll("a.cf-source");else{const o=document.querySelector(`#${e.id}+.tox-tinymce iframe`);a=o.contentWindow.document.querySelectorAll("img.cf-source"),d=o.contentWindow.document.querySelectorAll("a.cf-source")}a.forEach(o=>{const y=o.dataset.cf==1;C(o,()=>{v({url:y?`${b}/${o.dataset.src}`:o.dataset.src,key:m}).then(g=>{o.src=g}).catch(g=>{console.error(g)})})}),d.forEach(o=>{const y=o.dataset.cf==1;o.href=y?`${b}/${o.dataset.src}`:o.dataset.src}),p(i)},...e.options})})};return s({reload:()=>{setTimeout(()=>{l.destroy(),h()},0)}}),B(async()=>{H().then(h)}),j(()=>{l&&l.destroy()}),(c,p)=>(w(),z(V,null,[F("div",{id:e.id,class:I({"tinymce-inline-editor":r.options.inline})},null,10,M),L($,{open:f.value,"onUpdate:open":p[0]||(p[0]=_=>f.value=_),onInsert:S},null,8,["open"])],64))}};export{D as _};
